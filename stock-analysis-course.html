<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Analysis Mastery Course</title>
    <style>
        :root {
            --primary: #1a73e8;
            --primary-dark: #1557b0;
            --secondary: #34a853;
            --warning: #fbbc04;
            --danger: #ea4335;
            --dark: #202124;
            --gray: #5f6368;
            --light-gray: #f1f3f4;
            --white: #ffffff;
            --success: #137333;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--light-gray);
            color: var(--dark);
            line-height: 1.6;
        }

        /* Navigation */
        .navbar {
            background: var(--dark);
            color: var(--white);
            padding: 1rem 2rem;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .navbar h1 {
            font-size: 1.4rem;
            font-weight: 600;
        }

        .nav-progress {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .progress-bar {
            width: 200px;
            height: 8px;
            background: var(--gray);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--secondary);
            transition: width 0.3s;
        }

        .progress-text {
            font-size: 0.9rem;
            color: var(--light-gray);
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            top: 60px;
            left: 0;
            width: 280px;
            height: calc(100vh - 60px);
            background: var(--white);
            border-right: 1px solid #e0e0e0;
            overflow-y: auto;
            padding: 1rem 0;
        }

        .module-nav {
            list-style: none;
        }

        .module-nav li {
            border-bottom: 1px solid #eee;
        }

        .module-nav a {
            display: flex;
            align-items: center;
            padding: 1rem 1.5rem;
            text-decoration: none;
            color: var(--dark);
            transition: background 0.2s;
            gap: 0.75rem;
        }

        .module-nav a:hover {
            background: var(--light-gray);
        }

        .module-nav a.active {
            background: #e8f0fe;
            color: var(--primary);
            border-left: 3px solid var(--primary);
        }

        .module-nav a.completed::before {
            content: '✓';
            color: var(--secondary);
            font-weight: bold;
        }

        .module-number {
            width: 28px;
            height: 28px;
            background: var(--light-gray);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .module-nav a.active .module-number {
            background: var(--primary);
            color: var(--white);
        }

        /* Main Content */
        .main-content {
            margin-left: 280px;
            margin-top: 60px;
            padding: 2rem;
            min-height: calc(100vh - 60px);
        }

        .module-container {
            display: none;
            max-width: 1000px;
            margin: 0 auto;
        }

        .module-container.active {
            display: block;
        }

        .module-header {
            background: var(--white);
            padding: 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .module-header h2 {
            font-size: 1.75rem;
            margin-bottom: 0.5rem;
        }

        .module-header p {
            color: var(--gray);
        }

        /* Lesson Cards */
        .lesson-card {
            background: var(--white);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .lesson-card h3 {
            font-size: 1.3rem;
            margin-bottom: 1rem;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .lesson-card h4 {
            font-size: 1.1rem;
            margin: 1.5rem 0 0.75rem;
            color: var(--primary-dark);
        }

        .lesson-content p {
            margin-bottom: 1rem;
        }

        .lesson-content ul, .lesson-content ol {
            margin: 1rem 0 1rem 1.5rem;
        }

        .lesson-content li {
            margin-bottom: 0.5rem;
        }

        /* Formula Box */
        .formula-box {
            background: #f8f9fa;
            border-left: 4px solid var(--primary);
            padding: 1rem 1.5rem;
            margin: 1rem 0;
            font-family: 'Courier New', monospace;
            border-radius: 0 8px 8px 0;
        }

        .formula-box .formula-title {
            font-weight: 600;
            color: var(--primary-dark);
            margin-bottom: 0.5rem;
            font-family: 'Segoe UI', sans-serif;
        }

        /* Key Concept */
        .key-concept {
            background: #e8f5e9;
            border-left: 4px solid var(--secondary);
            padding: 1rem 1.5rem;
            margin: 1rem 0;
            border-radius: 0 8px 8px 0;
        }

        .key-concept strong {
            color: var(--success);
        }

        /* Warning Box */
        .warning-box {
            background: #fff3e0;
            border-left: 4px solid var(--warning);
            padding: 1rem 1.5rem;
            margin: 1rem 0;
            border-radius: 0 8px 8px 0;
        }

        /* Example Box */
        .example-box {
            background: #e3f2fd;
            border: 1px solid #90caf9;
            padding: 1.5rem;
            margin: 1rem 0;
            border-radius: 8px;
        }

        .example-box h5 {
            color: var(--primary-dark);
            margin-bottom: 0.75rem;
        }

        /* Calculator Styles */
        .calculator {
            background: var(--white);
            border: 2px solid var(--primary);
            border-radius: 12px;
            padding: 2rem;
            margin: 1.5rem 0;
        }

        .calculator h4 {
            color: var(--primary);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .calc-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .calc-group {
            display: flex;
            flex-direction: column;
        }

        .calc-group label {
            font-size: 0.9rem;
            color: var(--gray);
            margin-bottom: 0.25rem;
        }

        .calc-group input, .calc-group select {
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 1rem;
        }

        .calc-group input:focus, .calc-group select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(26, 115, 232, 0.1);
        }

        .calc-button {
            background: var(--primary);
            color: var(--white);
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            font-size: 1rem;
            cursor: pointer;
            transition: background 0.2s;
            margin-top: 1rem;
        }

        .calc-button:hover {
            background: var(--primary-dark);
        }

        .calc-result {
            background: var(--light-gray);
            padding: 1.5rem;
            border-radius: 8px;
            margin-top: 1rem;
        }

        .calc-result h5 {
            color: var(--primary);
            margin-bottom: 0.75rem;
        }

        .result-value {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--dark);
        }

        .result-breakdown {
            margin-top: 1rem;
            font-size: 0.9rem;
            color: var(--gray);
        }

        /* Quiz Styles */
        .quiz-container {
            background: var(--white);
            border: 2px solid var(--secondary);
            border-radius: 12px;
            padding: 2rem;
            margin: 1.5rem 0;
        }

        .quiz-container h4 {
            color: var(--secondary);
            margin-bottom: 1.5rem;
        }

        .quiz-question {
            margin-bottom: 1.5rem;
        }

        .quiz-question p {
            font-weight: 500;
            margin-bottom: 0.75rem;
        }

        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .quiz-option {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            border: 1px solid #ddd;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .quiz-option:hover {
            border-color: var(--primary);
            background: #f8f9fa;
        }

        .quiz-option.selected {
            border-color: var(--primary);
            background: #e8f0fe;
        }

        .quiz-option.correct {
            border-color: var(--secondary);
            background: #e8f5e9;
        }

        .quiz-option.incorrect {
            border-color: var(--danger);
            background: #fce8e6;
        }

        .quiz-option input {
            margin-right: 0.75rem;
        }

        .quiz-feedback {
            padding: 1rem;
            border-radius: 6px;
            margin-top: 1rem;
            display: none;
        }

        .quiz-feedback.correct {
            display: block;
            background: #e8f5e9;
            color: var(--success);
        }

        .quiz-feedback.incorrect {
            display: block;
            background: #fce8e6;
            color: var(--danger);
        }

        .submit-quiz {
            background: var(--secondary);
            color: var(--white);
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            font-size: 1rem;
            cursor: pointer;
            transition: background 0.2s;
        }

        .submit-quiz:hover {
            background: var(--success);
        }

        /* Practice Exercise */
        .practice-exercise {
            background: #fff8e1;
            border: 2px solid var(--warning);
            border-radius: 12px;
            padding: 2rem;
            margin: 1.5rem 0;
        }

        .practice-exercise h4 {
            color: #f57c00;
            margin-bottom: 1rem;
        }

        /* Table Styles */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }

        .data-table th, .data-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .data-table th {
            background: var(--light-gray);
            font-weight: 600;
        }

        .data-table tr:hover {
            background: #f8f9fa;
        }

        /* API Settings Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--white);
            padding: 2rem;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
        }

        .modal-content h3 {
            margin-bottom: 1rem;
        }

        .modal-content input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 6px;
            margin-bottom: 1rem;
        }

        /* Settings Button */
        .settings-btn {
            background: transparent;
            border: 1px solid var(--gray);
            color: var(--white);
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .settings-btn:hover {
            background: rgba(255,255,255,0.1);
        }

        /* Completion Badge */
        .completion-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: var(--secondary);
            color: var(--white);
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.85rem;
            margin-left: 1rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s;
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .calc-row {
                grid-template-columns: 1fr;
            }
        }

        /* Code Block */
        .code-block {
            background: #263238;
            color: #aed581;
            padding: 1.5rem;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            margin: 1rem 0;
        }

        .code-block .comment {
            color: #78909c;
        }

        .code-block .keyword {
            color: #80cbc4;
        }

        .code-block .string {
            color: #c5e1a5;
        }

        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 2px solid #e0e0e0;
            margin-bottom: 1.5rem;
        }

        .tab-btn {
            padding: 0.75rem 1.5rem;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            color: var(--gray);
            border-bottom: 2px solid transparent;
            margin-bottom: -2px;
            transition: all 0.2s;
        }

        .tab-btn:hover {
            color: var(--primary);
        }

        .tab-btn.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Live Data Section */
        .live-data-section {
            background: linear-gradient(135deg, #1a73e8 0%, #1557b0 100%);
            color: var(--white);
            padding: 2rem;
            border-radius: 12px;
            margin: 1.5rem 0;
        }

        .live-data-section h4 {
            margin-bottom: 1rem;
        }

        .stock-input-group {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .stock-input-group input {
            flex: 1;
            padding: 0.75rem;
            border: none;
            border-radius: 6px;
            font-size: 1rem;
        }

        .stock-input-group button {
            background: var(--white);
            color: var(--primary);
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
        }

        .stock-data-display {
            background: rgba(255,255,255,0.1);
            padding: 1.5rem;
            border-radius: 8px;
            margin-top: 1rem;
        }

        /* Lesson Navigation */
        .lesson-nav {
            display: flex;
            justify-content: space-between;
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 1px solid #e0e0e0;
        }

        .lesson-nav button {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border: 1px solid var(--primary);
            background: var(--white);
            color: var(--primary);
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.2s;
        }

        .lesson-nav button:hover {
            background: var(--primary);
            color: var(--white);
        }

        .lesson-nav button.primary {
            background: var(--primary);
            color: var(--white);
        }

        .lesson-nav button.primary:hover {
            background: var(--primary-dark);
        }

        /* Dashboard Styles */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .dashboard-card {
            background: var(--white);
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .dashboard-card h5 {
            color: var(--gray);
            font-size: 0.85rem;
            margin-bottom: 0.5rem;
        }

        .dashboard-card .value {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .dashboard-card .change {
            font-size: 0.9rem;
            margin-top: 0.25rem;
        }

        .dashboard-card .change.positive {
            color: var(--secondary);
        }

        .dashboard-card .change.negative {
            color: var(--danger);
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <h1>Stock Analysis Mastery</h1>
        <div class="nav-progress">
            <div class="progress-bar">
                <div class="progress-fill" id="globalProgress" style="width: 0%"></div>
            </div>
            <span class="progress-text" id="progressText">0% Complete</span>
            <button class="settings-btn" onclick="openSettings()">Settings</button>
        </div>
    </nav>

    <!-- Sidebar Navigation -->
    <aside class="sidebar">
        <ul class="module-nav">
            <li>
                <a href="#" class="active" onclick="showModule(0)">
                    <span class="module-number">1</span>
                    Foundations
                </a>
            </li>
            <li>
                <a href="#" onclick="showModule(1)">
                    <span class="module-number">2</span>
                    Financial Ratios
                </a>
            </li>
            <li>
                <a href="#" onclick="showModule(2)">
                    <span class="module-number">3</span>
                    DCF Valuation
                </a>
            </li>
            <li>
                <a href="#" onclick="showModule(3)">
                    <span class="module-number">4</span>
                    Comparable Analysis
                </a>
            </li>
            <li>
                <a href="#" onclick="showModule(4)">
                    <span class="module-number">5</span>
                    Probability & Stats
                </a>
            </li>
            <li>
                <a href="#" onclick="showModule(5)">
                    <span class="module-number">6</span>
                    Technical Basics
                </a>
            </li>
            <li>
                <a href="#" onclick="showModule(6)">
                    <span class="module-number">7</span>
                    Advanced Indicators
                </a>
            </li>
            <li>
                <a href="#" onclick="showModule(7)">
                    <span class="module-number">8</span>
                    30-Min Framework
                </a>
            </li>
            <li>
                <a href="#" onclick="showModule(8)">
                    <span class="module-number">9</span>
                    Python for Stocks
                </a>
            </li>
            <li>
                <a href="#" onclick="showModule(9)">
                    <span class="module-number">10</span>
                    R for Statistics
                </a>
            </li>
        </ul>
    </aside>

    <!-- Main Content Area -->
    <main class="main-content">
        <!-- Module 1: Foundations -->
        <div class="module-container active" id="module-0">
            <div class="module-header">
                <h2>Module 1: Foundations</h2>
                <p>Learn to read and understand the three core financial statements that every company reports.</p>
            </div>

            <!-- Lesson 1.1 -->
            <div class="lesson-card">
                <h3>Lesson 1.1: The Language of Business</h3>
                <div class="lesson-content">
                    <p>Financial statements are the language businesses use to communicate their performance. Every publicly traded company must file these with the SEC, making them freely available for your analysis.</p>

                    <h4>The Three Core Financial Statements</h4>
                    <ol>
                        <li><strong>Income Statement (P&L)</strong> - Shows profitability over a period (usually quarterly or annually)</li>
                        <li><strong>Balance Sheet</strong> - Shows what the company owns and owes at a specific point in time</li>
                        <li><strong>Cash Flow Statement</strong> - Shows actual cash moving in and out of the business</li>
                    </ol>

                    <div class="key-concept">
                        <strong>Key Insight:</strong> A company can be "profitable" on the income statement but still go bankrupt if it runs out of cash. That's why you need all three statements to get the full picture.
                    </div>

                    <h4>Where to Find Financial Statements</h4>
                    <ul>
                        <li><strong>SEC EDGAR</strong> (sec.gov) - Official filings (10-K annual, 10-Q quarterly)</li>
                        <li><strong>Yahoo Finance</strong> - Easy-to-read summaries</li>
                        <li><strong>Company Investor Relations</strong> - Usually under "Investors" on company websites</li>
                    </ul>

                    <div class="example-box">
                        <h5>Real Example: Apple Inc. (AAPL)</h5>
                        <p>Apple's fiscal year 2023 showed:</p>
                        <ul>
                            <li>Revenue: $383.3 billion</li>
                            <li>Net Income: $97.0 billion</li>
                            <li>Total Assets: $352.6 billion</li>
                            <li>Operating Cash Flow: $110.5 billion</li>
                        </ul>
                        <p>Notice how cash flow exceeds net income - this is a sign of high-quality earnings!</p>
                    </div>
                </div>
            </div>

            <!-- Lesson 1.2 -->
            <div class="lesson-card">
                <h3>Lesson 1.2: Income Statement Deep Dive</h3>
                <div class="lesson-content">
                    <p>The income statement shows how revenue transforms into profit (or loss) through a series of deductions.</p>

                    <h4>The Income Statement Structure</h4>
                    <table class="data-table">
                        <tr>
                            <th>Line Item</th>
                            <th>What It Means</th>
                            <th>Example (millions)</th>
                        </tr>
                        <tr>
                            <td><strong>Revenue (Sales)</strong></td>
                            <td>Total money received from selling products/services</td>
                            <td>$100,000</td>
                        </tr>
                        <tr>
                            <td>- Cost of Goods Sold (COGS)</td>
                            <td>Direct costs to make the product</td>
                            <td>($60,000)</td>
                        </tr>
                        <tr>
                            <td><strong>= Gross Profit</strong></td>
                            <td>Revenue minus direct costs</td>
                            <td>$40,000</td>
                        </tr>
                        <tr>
                            <td>- Operating Expenses (SG&A)</td>
                            <td>Salaries, marketing, rent, etc.</td>
                            <td>($20,000)</td>
                        </tr>
                        <tr>
                            <td><strong>= Operating Income (EBIT)</strong></td>
                            <td>Profit from core operations</td>
                            <td>$20,000</td>
                        </tr>
                        <tr>
                            <td>- Interest Expense</td>
                            <td>Cost of debt</td>
                            <td>($2,000)</td>
                        </tr>
                        <tr>
                            <td>- Taxes</td>
                            <td>Income taxes owed</td>
                            <td>($4,500)</td>
                        </tr>
                        <tr>
                            <td><strong>= Net Income</strong></td>
                            <td>Final profit (the "bottom line")</td>
                            <td>$13,500</td>
                        </tr>
                    </table>

                    <h4>Key Margins to Calculate</h4>
                    <div class="formula-box">
                        <div class="formula-title">Gross Margin</div>
                        Gross Margin = (Revenue - COGS) / Revenue × 100<br>
                        Example: ($100,000 - $60,000) / $100,000 = 40%
                    </div>

                    <div class="formula-box">
                        <div class="formula-title">Operating Margin</div>
                        Operating Margin = Operating Income / Revenue × 100<br>
                        Example: $20,000 / $100,000 = 20%
                    </div>

                    <div class="formula-box">
                        <div class="formula-title">Net Profit Margin</div>
                        Net Margin = Net Income / Revenue × 100<br>
                        Example: $13,500 / $100,000 = 13.5%
                    </div>

                    <div class="warning-box">
                        <strong>Watch Out:</strong> One-time items can distort margins. Look for "non-recurring" or "extraordinary" items and consider excluding them for a cleaner picture of ongoing profitability.
                    </div>
                </div>

                <!-- Margin Calculator -->
                <div class="calculator">
                    <h4>Margin Calculator</h4>
                    <div class="calc-row">
                        <div class="calc-group">
                            <label>Revenue ($)</label>
                            <input type="number" id="marginRevenue" placeholder="e.g., 100000">
                        </div>
                        <div class="calc-group">
                            <label>Cost of Goods Sold ($)</label>
                            <input type="number" id="marginCOGS" placeholder="e.g., 60000">
                        </div>
                    </div>
                    <div class="calc-row">
                        <div class="calc-group">
                            <label>Operating Expenses ($)</label>
                            <input type="number" id="marginOpex" placeholder="e.g., 20000">
                        </div>
                        <div class="calc-group">
                            <label>Net Income ($)</label>
                            <input type="number" id="marginNetIncome" placeholder="e.g., 13500">
                        </div>
                    </div>
                    <button class="calc-button" onclick="calculateMargins()">Calculate Margins</button>
                    <div class="calc-result" id="marginResult" style="display: none;">
                        <h5>Your Margin Analysis</h5>
                        <div id="marginOutput"></div>
                    </div>
                </div>
            </div>

            <!-- Lesson 1.3 -->
            <div class="lesson-card">
                <h3>Lesson 1.3: Balance Sheet Mastery</h3>
                <div class="lesson-content">
                    <p>The balance sheet is a snapshot of what a company owns (assets), owes (liabilities), and the residual belonging to shareholders (equity) at a specific point in time.</p>

                    <div class="formula-box">
                        <div class="formula-title">The Fundamental Accounting Equation</div>
                        Assets = Liabilities + Shareholders' Equity<br>
                        <em>This equation must ALWAYS balance - hence "balance sheet"</em>
                    </div>

                    <h4>Assets (What the Company Owns)</h4>
                    <p><strong>Current Assets</strong> - Can be converted to cash within 1 year:</p>
                    <ul>
                        <li>Cash and Cash Equivalents</li>
                        <li>Accounts Receivable (money owed by customers)</li>
                        <li>Inventory</li>
                        <li>Prepaid Expenses</li>
                    </ul>

                    <p><strong>Non-Current Assets</strong> - Long-term assets:</p>
                    <ul>
                        <li>Property, Plant & Equipment (PP&E)</li>
                        <li>Intangible Assets (patents, trademarks)</li>
                        <li>Goodwill (premium paid in acquisitions)</li>
                        <li>Long-term Investments</li>
                    </ul>

                    <h4>Liabilities (What the Company Owes)</h4>
                    <p><strong>Current Liabilities</strong> - Due within 1 year:</p>
                    <ul>
                        <li>Accounts Payable (money owed to suppliers)</li>
                        <li>Short-term Debt</li>
                        <li>Accrued Expenses</li>
                        <li>Deferred Revenue</li>
                    </ul>

                    <p><strong>Non-Current Liabilities</strong> - Due after 1 year:</p>
                    <ul>
                        <li>Long-term Debt</li>
                        <li>Pension Obligations</li>
                        <li>Lease Liabilities</li>
                    </ul>

                    <h4>Shareholders' Equity</h4>
                    <ul>
                        <li>Common Stock (money from issuing shares)</li>
                        <li>Retained Earnings (accumulated profits not paid as dividends)</li>
                        <li>Treasury Stock (shares bought back - reduces equity)</li>
                    </ul>

                    <div class="example-box">
                        <h5>Real Example: Balance Sheet Analysis</h5>
                        <table class="data-table">
                            <tr>
                                <th>Item</th>
                                <th>Amount (millions)</th>
                            </tr>
                            <tr>
                                <td>Total Assets</td>
                                <td>$500,000</td>
                            </tr>
                            <tr>
                                <td>Total Liabilities</td>
                                <td>$300,000</td>
                            </tr>
                            <tr>
                                <td>Shareholders' Equity</td>
                                <td>$200,000</td>
                            </tr>
                        </table>
                        <p>Check: $300,000 + $200,000 = $500,000 ✓</p>
                    </div>

                    <div class="key-concept">
                        <strong>Key Ratios from the Balance Sheet:</strong>
                        <ul>
                            <li><strong>Current Ratio</strong> = Current Assets / Current Liabilities (healthy: > 1.5)</li>
                            <li><strong>Debt-to-Equity</strong> = Total Debt / Shareholders' Equity (lower is generally safer)</li>
                            <li><strong>Book Value per Share</strong> = Shareholders' Equity / Shares Outstanding</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Lesson 1.4 -->
            <div class="lesson-card">
                <h3>Lesson 1.4: Cash Flow Statement</h3>
                <div class="lesson-content">
                    <p>The cash flow statement tracks actual cash movements. It's often considered the most important statement because <strong>cash is king</strong> - you can't pay bills with accounting profits.</p>

                    <h4>The Three Sections</h4>

                    <div class="key-concept">
                        <strong>1. Operating Activities (CFO)</strong><br>
                        Cash generated from core business operations. This is the most important section - it shows whether the business can sustain itself.
                    </div>

                    <p>Key items in Operating Cash Flow:</p>
                    <ul>
                        <li>Start with Net Income</li>
                        <li>Add back Depreciation & Amortization (non-cash expenses)</li>
                        <li>Adjust for changes in working capital (receivables, payables, inventory)</li>
                    </ul>

                    <div class="key-concept">
                        <strong>2. Investing Activities (CFI)</strong><br>
                        Cash spent on or received from investments and asset purchases. Usually negative for growing companies.
                    </div>

                    <p>Key items:</p>
                    <ul>
                        <li>Capital Expenditures (CapEx) - buying equipment, buildings</li>
                        <li>Acquisitions</li>
                        <li>Purchases/sales of investments</li>
                    </ul>

                    <div class="key-concept">
                        <strong>3. Financing Activities (CFF)</strong><br>
                        Cash from/to investors and creditors.
                    </div>

                    <p>Key items:</p>
                    <ul>
                        <li>Issuing/repurchasing stock</li>
                        <li>Borrowing/repaying debt</li>
                        <li>Dividends paid</li>
                    </ul>

                    <h4>Free Cash Flow (FCF) - The Most Important Metric</h4>
                    <div class="formula-box">
                        <div class="formula-title">Free Cash Flow</div>
                        FCF = Operating Cash Flow - Capital Expenditures<br><br>
                        This is the cash available to:<br>
                        • Pay dividends<br>
                        • Buy back shares<br>
                        • Pay down debt<br>
                        • Make acquisitions<br>
                        • Invest in growth
                    </div>

                    <div class="warning-box">
                        <strong>Red Flag:</strong> If a company consistently reports positive net income but negative operating cash flow, investigate! This could indicate aggressive accounting or collection problems.
                    </div>
                </div>

                <!-- FCF Calculator -->
                <div class="calculator">
                    <h4>Free Cash Flow Calculator</h4>
                    <div class="calc-row">
                        <div class="calc-group">
                            <label>Operating Cash Flow ($)</label>
                            <input type="number" id="fcfOCF" placeholder="e.g., 50000">
                        </div>
                        <div class="calc-group">
                            <label>Capital Expenditures ($)</label>
                            <input type="number" id="fcfCapex" placeholder="e.g., 15000">
                        </div>
                    </div>
                    <div class="calc-row">
                        <div class="calc-group">
                            <label>Shares Outstanding (millions)</label>
                            <input type="number" id="fcfShares" placeholder="e.g., 1000">
                        </div>
                        <div class="calc-group">
                            <label>Current Stock Price ($)</label>
                            <input type="number" id="fcfPrice" placeholder="e.g., 150">
                        </div>
                    </div>
                    <button class="calc-button" onclick="calculateFCF()">Calculate FCF</button>
                    <div class="calc-result" id="fcfResult" style="display: none;">
                        <h5>Free Cash Flow Analysis</h5>
                        <div id="fcfOutput"></div>
                    </div>
                </div>
            </div>

            <!-- Lesson 1.5 -->
            <div class="lesson-card">
                <h3>Lesson 1.5: Connecting the Three Statements</h3>
                <div class="lesson-content">
                    <p>The three financial statements are deeply interconnected. Understanding these connections is crucial for spotting inconsistencies and manipulation.</p>

                    <h4>How They Connect</h4>
                    <div class="example-box">
                        <h5>The Flow of Financial Information</h5>
                        <p><strong>Income Statement → Balance Sheet:</strong></p>
                        <ul>
                            <li>Net Income flows into Retained Earnings (increases equity)</li>
                            <li>Dividends reduce Retained Earnings</li>
                        </ul>

                        <p><strong>Income Statement → Cash Flow Statement:</strong></p>
                        <ul>
                            <li>Net Income is the starting point for Operating Cash Flow</li>
                            <li>Non-cash items (depreciation) are added back</li>
                        </ul>

                        <p><strong>Balance Sheet → Cash Flow Statement:</strong></p>
                        <ul>
                            <li>Changes in working capital affect Operating Cash Flow</li>
                            <li>Changes in debt/equity affect Financing Cash Flow</li>
                            <li>Changes in fixed assets affect Investing Cash Flow</li>
                        </ul>

                        <p><strong>Cash Flow Statement → Balance Sheet:</strong></p>
                        <ul>
                            <li>Net change in cash updates the Cash balance on Balance Sheet</li>
                        </ul>
                    </div>

                    <h4>CAGR: Measuring Growth Over Time</h4>
                    <div class="formula-box">
                        <div class="formula-title">Compound Annual Growth Rate (CAGR)</div>
                        CAGR = (Ending Value / Beginning Value)^(1/n) - 1<br><br>
                        Where n = number of years<br><br>
                        Example: Revenue grew from $50M to $80M over 5 years<br>
                        CAGR = ($80M / $50M)^(1/5) - 1 = 1.6^0.2 - 1 = 9.86%
                    </div>
                </div>

                <!-- CAGR Calculator -->
                <div class="calculator">
                    <h4>CAGR Calculator</h4>
                    <div class="calc-row">
                        <div class="calc-group">
                            <label>Beginning Value ($)</label>
                            <input type="number" id="cagrStart" placeholder="e.g., 50000000">
                        </div>
                        <div class="calc-group">
                            <label>Ending Value ($)</label>
                            <input type="number" id="cagrEnd" placeholder="e.g., 80000000">
                        </div>
                    </div>
                    <div class="calc-row">
                        <div class="calc-group">
                            <label>Number of Years</label>
                            <input type="number" id="cagrYears" placeholder="e.g., 5">
                        </div>
                    </div>
                    <button class="calc-button" onclick="calculateCAGR()">Calculate CAGR</button>
                    <div class="calc-result" id="cagrResult" style="display: none;">
                        <h5>Growth Analysis</h5>
                        <div id="cagrOutput"></div>
                    </div>
                </div>
            </div>

            <!-- Module 1 Quiz -->
            <div class="quiz-container">
                <h4>Module 1 Quiz: Test Your Knowledge</h4>

                <div class="quiz-question" id="q1">
                    <p>1. Which financial statement shows a company's profitability over a period of time?</p>
                    <div class="quiz-options">
                        <label class="quiz-option">
                            <input type="radio" name="q1" value="a"> Balance Sheet
                        </label>
                        <label class="quiz-option">
                            <input type="radio" name="q1" value="b"> Income Statement
                        </label>
                        <label class="quiz-option">
                            <input type="radio" name="q1" value="c"> Cash Flow Statement
                        </label>
                        <label class="quiz-option">
                            <input type="radio" name="q1" value="d"> Statement of Equity
                        </label>
                    </div>
                </div>

                <div class="quiz-question" id="q2">
                    <p>2. A company has Revenue of $200M, COGS of $120M, and Operating Expenses of $40M. What is the Operating Margin?</p>
                    <div class="quiz-options">
                        <label class="quiz-option">
                            <input type="radio" name="q2" value="a"> 40%
                        </label>
                        <label class="quiz-option">
                            <input type="radio" name="q2" value="b"> 20%
                        </label>
                        <label class="quiz-option">
                            <input type="radio" name="q2" value="c"> 60%
                        </label>
                        <label class="quiz-option">
                            <input type="radio" name="q2" value="d"> 30%
                        </label>
                    </div>
                </div>

                <div class="quiz-question" id="q3">
                    <p>3. Free Cash Flow is calculated as:</p>
                    <div class="quiz-options">
                        <label class="quiz-option">
                            <input type="radio" name="q3" value="a"> Net Income - Dividends
                        </label>
                        <label class="quiz-option">
                            <input type="radio" name="q3" value="b"> Operating Cash Flow - Capital Expenditures
                        </label>
                        <label class="quiz-option">
                            <input type="radio" name="q3" value="c"> Revenue - Total Expenses
                        </label>
                        <label class="quiz-option">
                            <input type="radio" name="q3" value="d"> Total Assets - Total Liabilities
                        </label>
                    </div>
                </div>

                <div class="quiz-question" id="q4">
                    <p>4. If a company's Current Ratio is 0.8, what does this indicate?</p>
                    <div class="quiz-options">
                        <label class="quiz-option">
                            <input type="radio" name="q4" value="a"> The company is highly profitable
                        </label>
                        <label class="quiz-option">
                            <input type="radio" name="q4" value="b"> The company may struggle to pay short-term obligations
                        </label>
                        <label class="quiz-option">
                            <input type="radio" name="q4" value="c"> The company has too much cash
                        </label>
                        <label class="quiz-option">
                            <input type="radio" name="q4" value="d"> The company is growing rapidly
                        </label>
                    </div>
                </div>

                <button class="submit-quiz" onclick="checkQuiz1()">Submit Quiz</button>
                <div class="quiz-feedback" id="quiz1Feedback"></div>
            </div>

            <!-- Practice Exercise -->
            <div class="practice-exercise">
                <h4>Practice Exercise: Analyze a Real Company</h4>
                <p>Now it's time to apply what you've learned. Follow these steps:</p>
                <ol>
                    <li>Go to <a href="https://finance.yahoo.com" target="_blank">Yahoo Finance</a></li>
                    <li>Search for Apple (AAPL) or any company you're interested in</li>
                    <li>Click on "Financials" to see the Income Statement</li>
                    <li>Calculate the following:
                        <ul>
                            <li>Gross Margin for the most recent year</li>
                            <li>Operating Margin for the most recent year</li>
                            <li>Net Profit Margin for the most recent year</li>
                            <li>3-year Revenue CAGR</li>
                        </ul>
                    </li>
                    <li>Click on "Balance Sheet" and find:
                        <ul>
                            <li>Current Ratio</li>
                            <li>Debt-to-Equity Ratio</li>
                        </ul>
                    </li>
                    <li>Click on "Cash Flow" and calculate:
                        <ul>
                            <li>Free Cash Flow</li>
                            <li>Compare FCF to Net Income - which is higher?</li>
                        </ul>
                    </li>
                </ol>
                <p><strong>Use the calculators above to verify your calculations!</strong></p>
            </div>

            <div class="lesson-nav">
                <button disabled>Previous Module</button>
                <button class="primary" onclick="showModule(1)">Next: Financial Ratios →</button>
            </div>
        </div>

        <!-- Module 2: Financial Ratios -->
        <div class="module-container" id="module-1">
            <div class="module-header">
                <h2>Module 2: Financial Ratios & Metrics</h2>
                <p>Master the 20+ essential ratios that professional analysts use to evaluate companies.</p>
            </div>

            <!-- Lesson 2.1: Profitability Ratios -->
            <div class="lesson-card">
                <h3>Lesson 2.1: Profitability Ratios</h3>
                <div class="lesson-content">
                    <p>Profitability ratios measure how effectively a company generates profit from its resources. These are the first ratios professional analysts examine.</p>

                    <h4>Return on Equity (ROE)</h4>
                    <div class="formula-box">
                        <div class="formula-title">Return on Equity</div>
                        ROE = Net Income / Shareholders' Equity × 100<br><br>
                        <strong>What it measures:</strong> How much profit a company generates for each dollar of shareholder investment.<br>
                        <strong>Good benchmark:</strong> > 15% is generally strong, > 20% is excellent
                    </div>

                    <div class="example-box">
                        <h5>Example: Calculating ROE</h5>
                        <p>Company XYZ has:</p>
                        <ul>
                            <li>Net Income: $50 million</li>
                            <li>Shareholders' Equity: $200 million</li>
                        </ul>
                        <p>ROE = $50M / $200M × 100 = <strong>25%</strong></p>
                        <p>This means the company generates $0.25 of profit for every $1 of shareholder equity.</p>
                    </div>

                    <h4>Return on Assets (ROA)</h4>
                    <div class="formula-box">
                        <div class="formula-title">Return on Assets</div>
                        ROA = Net Income / Total Assets × 100<br><br>
                        <strong>What it measures:</strong> How efficiently a company uses ALL its assets to generate profit.<br>
                        <strong>Good benchmark:</strong> Varies by industry; > 5% is decent, > 10% is strong
                    </div>

                    <h4>Return on Invested Capital (ROIC)</h4>
                    <div class="formula-box">
                        <div class="formula-title">Return on Invested Capital</div>
                        ROIC = NOPAT / Invested Capital × 100<br><br>
                        Where:<br>
                        • NOPAT = Operating Income × (1 - Tax Rate)<br>
                        • Invested Capital = Total Equity + Total Debt - Cash<br><br>
                        <strong>What it measures:</strong> Return generated on capital invested in the business (both debt and equity).<br>
                        <strong>Key insight:</strong> ROIC > WACC means the company creates value; ROIC < WACC destroys value.
                    </div>

                    <div class="key-concept">
                        <strong>The DuPont Analysis:</strong> Breaking down ROE into its components reveals the drivers of profitability.
                        <div class="formula-box" style="margin-top: 1rem;">
                            ROE = Net Margin × Asset Turnover × Equity Multiplier<br><br>
                            = (Net Income/Revenue) × (Revenue/Assets) × (Assets/Equity)<br><br>
                            This shows ROE can be improved by:<br>
                            1. Higher profit margins (efficiency)<br>
                            2. Better asset utilization (productivity)<br>
                            3. More leverage (risk)
                        </div>
                    </div>
                </div>

                <!-- Profitability Calculator -->
                <div class="calculator">
                    <h4>Profitability Ratio Calculator</h4>
                    <div class="calc-row">
                        <div class="calc-group">
                            <label>Net Income ($)</label>
                            <input type="number" id="profitNetIncome" placeholder="e.g., 50000000">
                        </div>
                        <div class="calc-group">
                            <label>Revenue ($)</label>
                            <input type="number" id="profitRevenue" placeholder="e.g., 500000000">
                        </div>
                    </div>
                    <div class="calc-row">
                        <div class="calc-group">
                            <label>Shareholders' Equity ($)</label>
                            <input type="number" id="profitEquity" placeholder="e.g., 200000000">
                        </div>
                        <div class="calc-group">
                            <label>Total Assets ($)</label>
                            <input type="number" id="profitAssets" placeholder="e.g., 400000000">
                        </div>
                    </div>
                    <button class="calc-button" onclick="calculateProfitability()">Calculate Ratios</button>
                    <div class="calc-result" id="profitResult" style="display: none;">
                        <h5>Profitability Analysis</h5>
                        <div id="profitOutput"></div>
                    </div>
                </div>
            </div>

            <!-- Lesson 2.2: Valuation Multiples -->
            <div class="lesson-card">
                <h3>Lesson 2.2: Valuation Multiples</h3>
                <div class="lesson-content">
                    <p>Valuation multiples help you quickly assess whether a stock is cheap or expensive relative to its fundamentals.</p>

                    <h4>Price-to-Earnings (P/E) Ratio</h4>
                    <div class="formula-box">
                        <div class="formula-title">P/E Ratio</div>
                        P/E = Stock Price / Earnings Per Share (EPS)<br>
                        <em>or</em><br>
                        P/E = Market Cap / Net Income<br><br>
                        <strong>Trailing P/E:</strong> Uses past 12 months earnings<br>
                        <strong>Forward P/E:</strong> Uses next 12 months expected earnings
                    </div>

                    <div class="example-box">
                        <h5>Interpreting P/E</h5>
                        <table class="data-table">
                            <tr><th>P/E Range</th><th>Typical Interpretation</th></tr>
                            <tr><td>< 10</td><td>Potentially undervalued OR troubled company</td></tr>
                            <tr><td>10-20</td><td>Fair value for mature, stable companies</td></tr>
                            <tr><td>20-30</td><td>Growth premium - market expects higher growth</td></tr>
                            <tr><td>> 30</td><td>High growth expectations OR overvalued</td></tr>
                            <tr><td>Negative</td><td>Company is losing money</td></tr>
                        </table>
                    </div>

                    <h4>Price-to-Sales (P/S) Ratio</h4>
                    <div class="formula-box">
                        <div class="formula-title">P/S Ratio</div>
                        P/S = Market Cap / Revenue<br><br>
                        <strong>When to use:</strong> Useful for unprofitable companies or comparing companies with different margins.<br>
                        <strong>Benchmark:</strong> Varies widely; tech often 5-10x, retail 0.5-1x
                    </div>

                    <h4>Price-to-Book (P/B) Ratio</h4>
                    <div class="formula-box">
                        <div class="formula-title">P/B Ratio</div>
                        P/B = Market Cap / Book Value (Shareholders' Equity)<br><br>
                        <strong>What it shows:</strong> Premium paid over net assets<br>
                        <strong>P/B < 1:</strong> Stock trades below liquidation value (may signal distress OR opportunity)
                    </div>

                    <h4>Enterprise Value to EBITDA (EV/EBITDA)</h4>
                    <div class="formula-box">
                        <div class="formula-title">EV/EBITDA</div>
                        Enterprise Value = Market Cap + Total Debt - Cash<br>
                        EBITDA = Earnings Before Interest, Taxes, Depreciation, Amortization<br><br>
                        EV/EBITDA = Enterprise Value / EBITDA<br><br>
                        <strong>Why it's useful:</strong> Capital structure neutral - allows comparison regardless of debt levels.<br>
                        <strong>Benchmark:</strong> 8-12x is typical; lower is cheaper
                    </div>

                    <div class="warning-box">
                        <strong>Important:</strong> Always compare multiples within the same industry. A P/E of 25 might be cheap for tech but expensive for utilities.
                    </div>
                </div>

                <!-- Valuation Calculator -->
                <div class="calculator">
                    <h4>Valuation Multiple Calculator</h4>
                    <div class="calc-row">
                        <div class="calc-group">
                            <label>Stock Price ($)</label>
                            <input type="number" id="valPrice" placeholder="e.g., 150">
                        </div>
                        <div class="calc-group">
                            <label>Shares Outstanding (millions)</label>
                            <input type="number" id="valShares" placeholder="e.g., 1000">
                        </div>
                    </div>
                    <div class="calc-row">
                        <div class="calc-group">
                            <label>EPS (Earnings Per Share) ($)</label>
                            <input type="number" id="valEPS" placeholder="e.g., 6.50">
                        </div>
                        <div class="calc-group">
                            <label>Revenue ($ millions)</label>
                            <input type="number" id="valRevenue" placeholder="e.g., 380000">
                        </div>
                    </div>
                    <div class="calc-row">
                        <div class="calc-group">
                            <label>Book Value ($ millions)</label>
                            <input type="number" id="valBook" placeholder="e.g., 65000">
                        </div>
                        <div class="calc-group">
                            <label>EBITDA ($ millions)</label>
                            <input type="number" id="valEBITDA" placeholder="e.g., 120000">
                        </div>
                    </div>
                    <div class="calc-row">
                        <div class="calc-group">
                            <label>Total Debt ($ millions)</label>
                            <input type="number" id="valDebt" placeholder="e.g., 110000">
                        </div>
                        <div class="calc-group">
                            <label>Cash ($ millions)</label>
                            <input type="number" id="valCash" placeholder="e.g., 25000">
                        </div>
                    </div>
                    <button class="calc-button" onclick="calculateValuation()">Calculate Multiples</button>
                    <div class="calc-result" id="valResult" style="display: none;">
                        <h5>Valuation Analysis</h5>
                        <div id="valOutput"></div>
                    </div>
                </div>
            </div>

            <!-- Lesson 2.3: Liquidity & Solvency -->
            <div class="lesson-card">
                <h3>Lesson 2.3: Liquidity & Solvency Ratios</h3>
                <div class="lesson-content">
                    <p>These ratios assess a company's ability to meet its financial obligations - both short-term (liquidity) and long-term (solvency).</p>

                    <h4>Liquidity Ratios</h4>
                    <div class="formula-box">
                        <div class="formula-title">Current Ratio</div>
                        Current Ratio = Current Assets / Current Liabilities<br><br>
                        <strong>Benchmark:</strong> > 1.5 is healthy, < 1.0 signals potential trouble
                    </div>

                    <div class="formula-box">
                        <div class="formula-title">Quick Ratio (Acid Test)</div>
                        Quick Ratio = (Current Assets - Inventory) / Current Liabilities<br><br>
                        <strong>Why exclude inventory?</strong> Inventory may not sell quickly in a crisis.<br>
                        <strong>Benchmark:</strong> > 1.0 is generally safe
                    </div>

                    <h4>Solvency Ratios</h4>
                    <div class="formula-box">
                        <div class="formula-title">Debt-to-Equity Ratio</div>
                        D/E = Total Debt / Shareholders' Equity<br><br>
                        <strong>What it shows:</strong> How much the company relies on debt vs equity financing.<br>
                        <strong>Benchmark:</strong> Varies by industry; < 1.0 is conservative, > 2.0 may be risky
                    </div>

                    <div class="formula-box">
                        <div class="formula-title">Interest Coverage Ratio</div>
                        Interest Coverage = EBIT / Interest Expense<br><br>
                        <strong>What it shows:</strong> How easily the company can pay interest on its debt.<br>
                        <strong>Benchmark:</strong> > 3x is safe, < 1.5x is dangerous
                    </div>

                    <div class="key-concept">
                        <strong>Red Flag Alert:</strong> A company with high debt, low interest coverage, and a current ratio below 1 is at significant risk of financial distress.
                    </div>
                </div>
            </div>

            <!-- Lesson 2.4: Efficiency Ratios -->
            <div class="lesson-card">
                <h3>Lesson 2.4: Efficiency Ratios</h3>
                <div class="lesson-content">
                    <p>Efficiency ratios measure how well a company manages its assets and operations.</p>

                    <h4>Asset Turnover</h4>
                    <div class="formula-box">
                        <div class="formula-title">Asset Turnover</div>
                        Asset Turnover = Revenue / Average Total Assets<br><br>
                        <strong>What it shows:</strong> How efficiently assets generate revenue.<br>
                        Higher is better - means more revenue per dollar of assets.
                    </div>

                    <h4>Inventory Turnover</h4>
                    <div class="formula-box">
                        <div class="formula-title">Inventory Turnover</div>
                        Inventory Turnover = COGS / Average Inventory<br>
                        Days Inventory Outstanding = 365 / Inventory Turnover<br><br>
                        <strong>What it shows:</strong> How quickly inventory sells.<br>
                        Higher turnover = fresher inventory, less capital tied up.
                    </div>

                    <h4>Receivables Turnover</h4>
                    <div class="formula-box">
                        <div class="formula-title">Receivables Turnover</div>
                        Receivables Turnover = Revenue / Average Accounts Receivable<br>
                        Days Sales Outstanding (DSO) = 365 / Receivables Turnover<br><br>
                        <strong>What it shows:</strong> How quickly customers pay.<br>
                        Lower DSO is better - means faster cash collection.
                    </div>

                    <div class="example-box">
                        <h5>The Cash Conversion Cycle</h5>
                        <p>CCC = Days Inventory + Days Receivables - Days Payables</p>
                        <p>This shows how long cash is tied up in operations. Negative CCC (like Amazon) means the company gets paid before it pays suppliers!</p>
                    </div>
                </div>
            </div>

            <!-- Lesson 2.5: Growth Metrics -->
            <div class="lesson-card">
                <h3>Lesson 2.5: Growth Metrics & PEG Ratio</h3>
                <div class="lesson-content">
                    <h4>PEG Ratio</h4>
                    <div class="formula-box">
                        <div class="formula-title">PEG Ratio (Price/Earnings to Growth)</div>
                        PEG = P/E Ratio / Earnings Growth Rate (%)<br><br>
                        <strong>Example:</strong> P/E of 30 with 30% growth = PEG of 1.0<br>
                        <strong>Interpretation:</strong><br>
                        • PEG < 1: Potentially undervalued relative to growth<br>
                        • PEG = 1: Fairly valued<br>
                        • PEG > 1: May be overvalued relative to growth
                    </div>

                    <h4>Rule of 40 (for SaaS/Tech)</h4>
                    <div class="formula-box">
                        <div class="formula-title">Rule of 40</div>
                        Revenue Growth Rate (%) + Profit Margin (%) ≥ 40%<br><br>
                        <strong>Example 1:</strong> 30% growth + 15% margin = 45% ✓<br>
                        <strong>Example 2:</strong> 50% growth + (-5%) margin = 45% ✓<br>
                        <strong>Example 3:</strong> 15% growth + 10% margin = 25% ✗
                    </div>

                    <div class="key-concept">
                        <strong>Why This Matters:</strong> The Rule of 40 helps evaluate the tradeoff between growth and profitability. A high-growth unprofitable company may still be healthy if growth compensates.
                    </div>
                </div>

                <!-- PEG Calculator -->
                <div class="calculator">
                    <h4>PEG & Rule of 40 Calculator</h4>
                    <div class="calc-row">
                        <div class="calc-group">
                            <label>P/E Ratio</label>
                            <input type="number" id="pegPE" placeholder="e.g., 25">
                        </div>
                        <div class="calc-group">
                            <label>Expected EPS Growth Rate (%)</label>
                            <input type="number" id="pegGrowth" placeholder="e.g., 20">
                        </div>
                    </div>
                    <div class="calc-row">
                        <div class="calc-group">
                            <label>Revenue Growth Rate (%)</label>
                            <input type="number" id="rule40Growth" placeholder="e.g., 30">
                        </div>
                        <div class="calc-group">
                            <label>Profit Margin (%)</label>
                            <input type="number" id="rule40Margin" placeholder="e.g., 15">
                        </div>
                    </div>
                    <button class="calc-button" onclick="calculatePEG()">Calculate</button>
                    <div class="calc-result" id="pegResult" style="display: none;">
                        <h5>Growth Analysis</h5>
                        <div id="pegOutput"></div>
                    </div>
                </div>
            </div>

            <!-- DuPont Analysis Tool -->
            <div class="calculator" style="border-color: var(--secondary);">
                <h4 style="color: var(--secondary);">DuPont Analysis Calculator</h4>
                <p>Break down ROE into its three components to understand what's driving profitability.</p>
                <div class="calc-row">
                    <div class="calc-group">
                        <label>Net Income ($)</label>
                        <input type="number" id="dupontNetIncome" placeholder="e.g., 50000000">
                    </div>
                    <div class="calc-group">
                        <label>Revenue ($)</label>
                        <input type="number" id="dupontRevenue" placeholder="e.g., 500000000">
                    </div>
                </div>
                <div class="calc-row">
                    <div class="calc-group">
                        <label>Total Assets ($)</label>
                        <input type="number" id="dupontAssets" placeholder="e.g., 400000000">
                    </div>
                    <div class="calc-group">
                        <label>Shareholders' Equity ($)</label>
                        <input type="number" id="dupontEquity" placeholder="e.g., 200000000">
                    </div>
                </div>
                <button class="calc-button" style="background: var(--secondary);" onclick="calculateDuPont()">Analyze ROE</button>
                <div class="calc-result" id="dupontResult" style="display: none;">
                    <h5>DuPont Analysis</h5>
                    <div id="dupontOutput"></div>
                </div>
            </div>

            <!-- Module 2 Quiz -->
            <div class="quiz-container">
                <h4>Module 2 Quiz: Test Your Knowledge</h4>

                <div class="quiz-question" id="m2q1">
                    <p>1. A company has a P/E of 20 and expected earnings growth of 25%. What is the PEG ratio?</p>
                    <div class="quiz-options">
                        <label class="quiz-option"><input type="radio" name="m2q1" value="a"> 0.50</label>
                        <label class="quiz-option"><input type="radio" name="m2q1" value="b"> 0.80</label>
                        <label class="quiz-option"><input type="radio" name="m2q1" value="c"> 1.25</label>
                        <label class="quiz-option"><input type="radio" name="m2q1" value="d"> 5.00</label>
                    </div>
                </div>

                <div class="quiz-question" id="m2q2">
                    <p>2. Which valuation multiple is capital structure neutral (accounts for debt)?</p>
                    <div class="quiz-options">
                        <label class="quiz-option"><input type="radio" name="m2q2" value="a"> P/E Ratio</label>
                        <label class="quiz-option"><input type="radio" name="m2q2" value="b"> P/S Ratio</label>
                        <label class="quiz-option"><input type="radio" name="m2q2" value="c"> EV/EBITDA</label>
                        <label class="quiz-option"><input type="radio" name="m2q2" value="d"> P/B Ratio</label>
                    </div>
                </div>

                <div class="quiz-question" id="m2q3">
                    <p>3. In DuPont Analysis, ROE equals:</p>
                    <div class="quiz-options">
                        <label class="quiz-option"><input type="radio" name="m2q3" value="a"> Net Margin × Asset Turnover × Equity Multiplier</label>
                        <label class="quiz-option"><input type="radio" name="m2q3" value="b"> Gross Margin × Debt Ratio × P/E</label>
                        <label class="quiz-option"><input type="radio" name="m2q3" value="c"> EBITDA ÷ Enterprise Value</label>
                        <label class="quiz-option"><input type="radio" name="m2q3" value="d"> Operating Income ÷ Total Assets</label>
                    </div>
                </div>

                <div class="quiz-question" id="m2q4">
                    <p>4. A SaaS company has 35% revenue growth and -10% profit margin. Does it pass the Rule of 40?</p>
                    <div class="quiz-options">
                        <label class="quiz-option"><input type="radio" name="m2q4" value="a"> Yes, it equals 45%</label>
                        <label class="quiz-option"><input type="radio" name="m2q4" value="b"> Yes, it equals 25%</label>
                        <label class="quiz-option"><input type="radio" name="m2q4" value="c"> No, it equals 25%</label>
                        <label class="quiz-option"><input type="radio" name="m2q4" value="d"> No, negative margins disqualify it</label>
                    </div>
                </div>

                <button class="submit-quiz" onclick="checkQuiz2()">Submit Quiz</button>
                <div class="quiz-feedback" id="quiz2Feedback"></div>
            </div>

            <div class="lesson-nav">
                <button onclick="showModule(0)">← Previous: Foundations</button>
                <button class="primary" onclick="showModule(2)">Next: DCF Valuation →</button>
            </div>
        </div>

        <div class="module-container" id="module-2">
            <div class="module-header">
                <h2>Module 3: DCF Valuation</h2>
                <p>Learn to calculate intrinsic value using discounted cash flow analysis.</p>
            </div>
            <div class="lesson-card">
                <h3>Loading Module 3...</h3>
                <p>This module is being built. Content coming soon!</p>
            </div>
        </div>

        <div class="module-container" id="module-3">
            <div class="module-header">
                <h2>Module 4: Comparable Company Analysis (Comps)</h2>
                <p>Master relative valuation using peer comparisons, trading multiples, and regression analysis.</p>
            </div>

            <!-- Lesson 4.1 -->
            <div class="lesson-card">
                <h3>Lesson 4.1: The Logic Behind Relative Valuation</h3>
                <div class="lesson-content">
                    <p>Comparable Company Analysis (Comps) values a company by comparing it to similar publicly traded companies. The core assumption: <strong>similar companies should trade at similar multiples</strong>.</p>

                    <h4>Why Use Comps?</h4>
                    <ul>
                        <li><strong>Market-Based:</strong> Reflects what investors are actually willing to pay</li>
                        <li><strong>Quick & Intuitive:</strong> Faster than building complex DCF models</li>
                        <li><strong>Sanity Check:</strong> Validates other valuation methods</li>
                        <li><strong>M&A Pricing:</strong> Investment banks use comps to price acquisitions</li>
                    </ul>

                    <div class="key-concept">
                        <strong>The Law of One Price:</strong> In efficient markets, identical assets should trade at identical prices. Comps extends this: similar assets should trade at similar prices relative to their fundamentals.
                    </div>

                    <h4>The Five-Step Comps Process</h4>
                    <ol>
                        <li><strong>Select Peer Group</strong> - Find truly comparable companies</li>
                        <li><strong>Gather Financial Data</strong> - Collect relevant metrics</li>
                        <li><strong>Calculate Multiples</strong> - Compute valuation ratios</li>
                        <li><strong>Benchmark & Analyze</strong> - Compare target to peers</li>
                        <li><strong>Apply Multiples</strong> - Derive implied valuation</li>
                    </ol>

                    <div class="warning-box">
                        <strong>Critical Warning:</strong> Comps can lead to systematic mispricing. During the dot-com bubble, using comps justified insane valuations because "everyone else was expensive too." Always combine with intrinsic valuation methods.
                    </div>
                </div>
            </div>

            <!-- Lesson 4.2 -->
            <div class="lesson-card">
                <h3>Lesson 4.2: Selecting the Right Peer Group</h3>
                <div class="lesson-content">
                    <p>Peer selection is the most subjective and critical step. Poor peer selection = garbage valuation.</p>

                    <h4>Peer Selection Criteria (SIGMAR Framework)</h4>
                    <table class="data-table">
                        <tr>
                            <th>Criteria</th>
                            <th>Description</th>
                            <th>Why It Matters</th>
                        </tr>
                        <tr>
                            <td><strong>S</strong>ector/Industry</td>
                            <td>Same GICS sector and sub-industry</td>
                            <td>Similar business models and margin structures</td>
                        </tr>
                        <tr>
                            <td><strong>I</strong>ncome Profile</td>
                            <td>Similar profitability and growth rates</td>
                            <td>High-growth deserves higher multiples</td>
                        </tr>
                        <tr>
                            <td><strong>G</strong>eography</td>
                            <td>Same primary markets</td>
                            <td>Currency, regulation, and macro exposure</td>
                        </tr>
                        <tr>
                            <td><strong>M</strong>arket Cap</td>
                            <td>Similar size (within 0.5x-2x range)</td>
                            <td>Size affects liquidity premium</td>
                        </tr>
                        <tr>
                            <td><strong>A</strong>sset Base</td>
                            <td>Similar capital intensity</td>
                            <td>Asset-heavy vs. asset-light models differ</td>
                        </tr>
                        <tr>
                            <td><strong>R</strong>isk Profile</td>
                            <td>Similar beta and leverage</td>
                            <td>Risk affects required returns</td>
                        </tr>
                    </table>

                    <h4>Python: Automated Peer Selection</h4>
                    <div class="code-block">
<span class="comment"># Peer Selection Algorithm using Financial Metrics</span>
<span class="keyword">import</span> yfinance <span class="keyword">as</span> yf
<span class="keyword">import</span> pandas <span class="keyword">as</span> pd
<span class="keyword">import</span> numpy <span class="keyword">as</span> np

<span class="keyword">def</span> <span class="string">get_peer_candidates</span>(target_ticker, sector_tickers):
    <span class="string">"""
    Score potential peers based on similarity metrics.
    Returns ranked list of most comparable companies.
    """</span>
    target = yf.Ticker(target_ticker)
    target_info = target.info

    <span class="comment"># Target characteristics</span>
    target_metrics = {
        <span class="string">'market_cap'</span>: target_info.get(<span class="string">'marketCap'</span>, 0),
        <span class="string">'revenue_growth'</span>: target_info.get(<span class="string">'revenueGrowth'</span>, 0),
        <span class="string">'profit_margin'</span>: target_info.get(<span class="string">'profitMargins'</span>, 0),
        <span class="string">'beta'</span>: target_info.get(<span class="string">'beta'</span>, 1),
        <span class="string">'debt_equity'</span>: target_info.get(<span class="string">'debtToEquity'</span>, 0)
    }

    peer_scores = []
    <span class="keyword">for</span> ticker <span class="keyword">in</span> sector_tickers:
        <span class="keyword">try</span>:
            peer = yf.Ticker(ticker)
            peer_info = peer.info

            <span class="comment"># Calculate similarity score (lower = more similar)</span>
            score = 0
            score += abs(np.log(peer_info.get(<span class="string">'marketCap'</span>, 1) /
                        max(target_metrics[<span class="string">'market_cap'</span>], 1)))
            score += abs((peer_info.get(<span class="string">'revenueGrowth'</span>, 0) or 0) -
                        (target_metrics[<span class="string">'revenue_growth'</span>] or 0)) * 5
            score += abs((peer_info.get(<span class="string">'profitMargins'</span>, 0) or 0) -
                        (target_metrics[<span class="string">'profit_margin'</span>] or 0)) * 3
            score += abs((peer_info.get(<span class="string">'beta'</span>, 1) or 1) -
                        (target_metrics[<span class="string">'beta'</span>] or 1))

            peer_scores.append({
                <span class="string">'ticker'</span>: ticker,
                <span class="string">'name'</span>: peer_info.get(<span class="string">'shortName'</span>, ticker),
                <span class="string">'similarity_score'</span>: score,
                <span class="string">'market_cap_b'</span>: peer_info.get(<span class="string">'marketCap'</span>, 0) / 1e9
            })
        <span class="keyword">except</span>:
            <span class="keyword">continue</span>

    <span class="comment"># Return sorted by similarity (most similar first)</span>
    <span class="keyword">return</span> pd.DataFrame(peer_scores).sort_values(<span class="string">'similarity_score'</span>)

<span class="comment"># Example: Find peers for NVIDIA</span>
semiconductor_tickers = [<span class="string">'AMD'</span>, <span class="string">'INTC'</span>, <span class="string">'QCOM'</span>, <span class="string">'AVGO'</span>, <span class="string">'TXN'</span>, <span class="string">'MU'</span>]
peers = get_peer_candidates(<span class="string">'NVDA'</span>, semiconductor_tickers)
print(peers.head(5))
                    </div>

                    <div class="example-box">
                        <h5>Peer Group Example: Analyzing Tesla (TSLA)</h5>
                        <p><strong>Challenge:</strong> Is Tesla an auto company or a tech company?</p>
                        <p><strong>Traditional Auto Peers:</strong> GM, F, STLA - Trade at 5-8x earnings</p>
                        <p><strong>Tech/Growth Peers:</strong> AMZN, GOOGL - Trade at 25-40x earnings</p>
                        <p><strong>Resolution:</strong> Use a blended peer set, weight by business segment revenue, or analyze both scenarios separately.</p>
                    </div>
                </div>
            </div>

            <!-- Lesson 4.3 -->
            <div class="lesson-card">
                <h3>Lesson 4.3: Essential Valuation Multiples</h3>
                <div class="lesson-content">
                    <h4>Enterprise Value vs. Equity Value Multiples</h4>

                    <div class="formula-box">
                        <div class="formula-title">Enterprise Value (EV)</div>
                        EV = Market Cap + Total Debt - Cash & Equivalents<br>
                        <em>Represents the total takeover price of a business</em>
                    </div>

                    <table class="data-table">
                        <tr>
                            <th>Multiple</th>
                            <th>Formula</th>
                            <th>Best For</th>
                            <th>Typical Range</th>
                        </tr>
                        <tr>
                            <td><strong>EV/Revenue</strong></td>
                            <td>Enterprise Value / Revenue</td>
                            <td>Pre-profit companies, SaaS</td>
                            <td>1x - 20x</td>
                        </tr>
                        <tr>
                            <td><strong>EV/EBITDA</strong></td>
                            <td>Enterprise Value / EBITDA</td>
                            <td>Most industries (gold standard)</td>
                            <td>6x - 15x</td>
                        </tr>
                        <tr>
                            <td><strong>EV/EBIT</strong></td>
                            <td>Enterprise Value / Operating Income</td>
                            <td>Capital-intensive businesses</td>
                            <td>8x - 20x</td>
                        </tr>
                        <tr>
                            <td><strong>P/E</strong></td>
                            <td>Price / Earnings Per Share</td>
                            <td>Mature, profitable companies</td>
                            <td>10x - 30x</td>
                        </tr>
                        <tr>
                            <td><strong>P/B</strong></td>
                            <td>Price / Book Value</td>
                            <td>Banks, asset-heavy industries</td>
                            <td>0.5x - 3x</td>
                        </tr>
                        <tr>
                            <td><strong>P/FCF</strong></td>
                            <td>Price / Free Cash Flow</td>
                            <td>Cash-generative businesses</td>
                            <td>10x - 25x</td>
                        </tr>
                    </table>

                    <h4>Python: Complete Comps Analysis</h4>
                    <div class="code-block">
<span class="keyword">import</span> yfinance <span class="keyword">as</span> yf
<span class="keyword">import</span> pandas <span class="keyword">as</span> pd

<span class="keyword">def</span> <span class="string">build_comps_table</span>(tickers):
    <span class="string">"""
    Build comprehensive comparable company analysis table.
    """</span>
    data = []

    <span class="keyword">for</span> ticker <span class="keyword">in</span> tickers:
        <span class="keyword">try</span>:
            stock = yf.Ticker(ticker)
            info = stock.info

            <span class="comment"># Get financials</span>
            market_cap = info.get(<span class="string">'marketCap'</span>, 0)
            total_debt = info.get(<span class="string">'totalDebt'</span>, 0)
            cash = info.get(<span class="string">'totalCash'</span>, 0)
            revenue = info.get(<span class="string">'totalRevenue'</span>, 0)
            ebitda = info.get(<span class="string">'ebitda'</span>, 0)
            net_income = info.get(<span class="string">'netIncomeToCommon'</span>, 0)
            fcf = info.get(<span class="string">'freeCashflow'</span>, 0)
            book_value = info.get(<span class="string">'bookValue'</span>, 0)
            shares = info.get(<span class="string">'sharesOutstanding'</span>, 0)

            <span class="comment"># Calculate Enterprise Value</span>
            ev = market_cap + total_debt - cash

            <span class="comment"># Calculate multiples (handle division by zero)</span>
            ev_revenue = ev / revenue <span class="keyword">if</span> revenue > 0 <span class="keyword">else</span> None
            ev_ebitda = ev / ebitda <span class="keyword">if</span> ebitda > 0 <span class="keyword">else</span> None
            pe_ratio = info.get(<span class="string">'trailingPE'</span>, None)
            pb_ratio = market_cap / (book_value * shares) <span class="keyword">if</span> book_value > 0 <span class="keyword">else</span> None
            pfcf = market_cap / fcf <span class="keyword">if</span> fcf > 0 <span class="keyword">else</span> None

            data.append({
                <span class="string">'Ticker'</span>: ticker,
                <span class="string">'Company'</span>: info.get(<span class="string">'shortName'</span>, ticker),
                <span class="string">'Market Cap ($B)'</span>: round(market_cap / 1e9, 1),
                <span class="string">'EV ($B)'</span>: round(ev / 1e9, 1),
                <span class="string">'EV/Revenue'</span>: round(ev_revenue, 2) <span class="keyword">if</span> ev_revenue <span class="keyword">else</span> <span class="string">'N/A'</span>,
                <span class="string">'EV/EBITDA'</span>: round(ev_ebitda, 1) <span class="keyword">if</span> ev_ebitda <span class="keyword">else</span> <span class="string">'N/A'</span>,
                <span class="string">'P/E'</span>: round(pe_ratio, 1) <span class="keyword">if</span> pe_ratio <span class="keyword">else</span> <span class="string">'N/A'</span>,
                <span class="string">'P/B'</span>: round(pb_ratio, 2) <span class="keyword">if</span> pb_ratio <span class="keyword">else</span> <span class="string">'N/A'</span>,
                <span class="string">'P/FCF'</span>: round(pfcf, 1) <span class="keyword">if</span> pfcf <span class="keyword">else</span> <span class="string">'N/A'</span>,
                <span class="string">'Revenue Growth'</span>: f"{(info.get('revenueGrowth', 0) or 0)*100:.1f}%",
                <span class="string">'Profit Margin'</span>: f"{(info.get('profitMargins', 0) or 0)*100:.1f}%"
            })
        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:
            print(f<span class="string">"Error processing {ticker}: {e}"</span>)

    df = pd.DataFrame(data)

    <span class="comment"># Calculate summary statistics</span>
    numeric_cols = [<span class="string">'EV/Revenue'</span>, <span class="string">'EV/EBITDA'</span>, <span class="string">'P/E'</span>, <span class="string">'P/B'</span>, <span class="string">'P/FCF'</span>]
    summary = {}
    <span class="keyword">for</span> col <span class="keyword">in</span> numeric_cols:
        values = pd.to_numeric(df[col], errors=<span class="string">'coerce'</span>).dropna()
        <span class="keyword">if</span> len(values) > 0:
            summary[col] = {
                <span class="string">'Mean'</span>: round(values.mean(), 2),
                <span class="string">'Median'</span>: round(values.median(), 2),
                <span class="string">'Min'</span>: round(values.min(), 2),
                <span class="string">'Max'</span>: round(values.max(), 2)
            }

    <span class="keyword">return</span> df, pd.DataFrame(summary)

<span class="comment"># Example: Tech Giants Comparison</span>
tech_tickers = [<span class="string">'AAPL'</span>, <span class="string">'MSFT'</span>, <span class="string">'GOOGL'</span>, <span class="string">'META'</span>, <span class="string">'AMZN'</span>]
comps_df, summary_df = build_comps_table(tech_tickers)
print(comps_df.to_string(index=False))
print(<span class="string">"\nSummary Statistics:"</span>)
print(summary_df)
                    </div>

                    <h4>R: Statistical Analysis of Multiples</h4>
                    <div class="code-block">
<span class="comment"># R: Regression-Based Multiple Analysis</span>
<span class="keyword">library</span>(tidyverse)
<span class="keyword">library</span>(quantmod)

<span class="comment"># Create sample comps data</span>
comps_data <- tibble(
  ticker = c(<span class="string">"AAPL"</span>, <span class="string">"MSFT"</span>, <span class="string">"GOOGL"</span>, <span class="string">"META"</span>, <span class="string">"AMZN"</span>),
  ev_ebitda = c(22.5, 19.8, 14.2, 11.5, 18.3),
  revenue_growth = c(0.08, 0.12, 0.10, 0.15, 0.11),
  ebitda_margin = c(0.33, 0.45, 0.32, 0.40, 0.15),
  roic = c(0.55, 0.35, 0.25, 0.28, 0.12)
)

<span class="comment"># Regression: What drives EV/EBITDA multiples?</span>
model <- lm(ev_ebitda ~ revenue_growth + ebitda_margin + roic,
            data = comps_data)

<span class="comment"># Model summary</span>
summary(model)

<span class="comment"># Predict fair multiple for a target company</span>
target_company <- tibble(
  revenue_growth = 0.14,
  ebitda_margin = 0.38,
  roic = 0.30
)

predicted_multiple <- predict(model, target_company)
cat(<span class="string">"Predicted Fair EV/EBITDA:"</span>, round(predicted_multiple, 1), <span class="string">"x\n"</span>)

<span class="comment"># Calculate confidence interval</span>
ci <- predict(model, target_company, interval = <span class="string">"confidence"</span>, level = 0.95)
cat(<span class="string">"95% CI:"</span>, round(ci[2], 1), <span class="string">"x -"</span>, round(ci[3], 1), <span class="string">"x\n"</span>)
                    </div>
                </div>

                <!-- Comps Calculator -->
                <div class="calculator">
                    <h4>Implied Valuation Calculator</h4>
                    <div class="calc-row">
                        <div class="calc-group">
                            <label>Target Company EBITDA ($M)</label>
                            <input type="number" id="compEbitda" placeholder="e.g., 5000">
                        </div>
                        <div class="calc-group">
                            <label>Peer Median EV/EBITDA</label>
                            <input type="number" id="compMultiple" placeholder="e.g., 12.5" step="0.1">
                        </div>
                    </div>
                    <div class="calc-row">
                        <div class="calc-group">
                            <label>Target Net Debt ($M)</label>
                            <input type="number" id="compDebt" placeholder="e.g., 2000">
                        </div>
                        <div class="calc-group">
                            <label>Shares Outstanding (M)</label>
                            <input type="number" id="compShares" placeholder="e.g., 500">
                        </div>
                    </div>
                    <button class="calc-button" onclick="calculateComps()">Calculate Implied Value</button>
                    <div class="calc-result" id="compsResult" style="display: none;">
                        <h5>Implied Valuation</h5>
                        <div id="compsOutput"></div>
                    </div>
                </div>
            </div>

            <!-- Lesson 4.4 -->
            <div class="lesson-card">
                <h3>Lesson 4.4: Football Field Analysis & Sensitivity</h3>
                <div class="lesson-content">
                    <p>A "football field" chart shows the range of implied valuations from different methodologies and multiple ranges.</p>

                    <h4>Creating Valuation Ranges</h4>
                    <div class="formula-box">
                        <div class="formula-title">Implied Share Price Range</div>
                        Low Estimate = (EBITDA × Low Multiple - Net Debt) / Shares<br>
                        High Estimate = (EBITDA × High Multiple - Net Debt) / Shares<br>
                        Mid Estimate = (EBITDA × Median Multiple - Net Debt) / Shares
                    </div>

                    <h4>Python: Football Field Visualization</h4>
                    <div class="code-block">
<span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt
<span class="keyword">import</span> numpy <span class="keyword">as</span> np

<span class="keyword">def</span> <span class="string">create_football_field</span>(company_name, valuations):
    <span class="string">"""
    Create a football field valuation chart.
    valuations: dict with methodology names as keys,
                (low, mid, high) tuples as values
    """</span>
    fig, ax = plt.subplots(figsize=(12, 6))

    methods = list(valuations.keys())
    y_positions = range(len(methods))

    colors = [<span class="string">'#1a73e8'</span>, <span class="string">'#34a853'</span>, <span class="string">'#fbbc04'</span>, <span class="string">'#ea4335'</span>, <span class="string">'#9c27b0'</span>]

    <span class="keyword">for</span> i, (method, (low, mid, high)) <span class="keyword">in</span> enumerate(valuations.items()):
        <span class="comment"># Draw range bar</span>
        ax.barh(i, high - low, left=low, height=0.4,
                color=colors[i % len(colors)], alpha=0.6)
        <span class="comment"># Draw midpoint marker</span>
        ax.plot(mid, i, <span class="string">'ko'</span>, markersize=10)
        <span class="comment"># Add value labels</span>
        ax.text(low - 2, i, f<span class="string">'${low:.0f}'</span>, ha=<span class="string">'right'</span>, va=<span class="string">'center'</span>)
        ax.text(high + 2, i, f<span class="string">'${high:.0f}'</span>, ha=<span class="string">'left'</span>, va=<span class="string">'center'</span>)

    ax.set_yticks(y_positions)
    ax.set_yticklabels(methods)
    ax.set_xlabel(<span class="string">'Implied Share Price ($)'</span>)
    ax.set_title(f<span class="string">'{company_name} - Valuation Football Field'</span>)
    ax.axvline(x=np.mean([v[1] <span class="keyword">for</span> v <span class="keyword">in</span> valuations.values()]),
               color=<span class="string">'red'</span>, linestyle=<span class="string">'--'</span>, label=<span class="string">'Average Mid'</span>)
    ax.legend()
    ax.grid(axis=<span class="string">'x'</span>, alpha=0.3)

    plt.tight_layout()
    <span class="keyword">return</span> fig

<span class="comment"># Example valuations for a company</span>
valuations = {
    <span class="string">'DCF Analysis'</span>: (145, 168, 195),
    <span class="string">'EV/EBITDA Comps'</span>: (155, 172, 190),
    <span class="string">'P/E Comps'</span>: (140, 160, 185),
    <span class="string">'52-Week Range'</span>: (132, 165, 198),
    <span class="string">'Analyst Targets'</span>: (150, 175, 200)
}

fig = create_football_field(<span class="string">'Target Corp'</span>, valuations)
plt.show()
                    </div>

                    <div class="practice-exercise">
                        <h4>Practice Exercise: Build Your Own Comps</h4>
                        <p>Select a company you're interested in and complete this analysis:</p>
                        <ol>
                            <li>Identify 5-7 comparable companies using the SIGMAR framework</li>
                            <li>Calculate EV/EBITDA, EV/Revenue, and P/E for each peer</li>
                            <li>Compute mean, median, and quartile ranges</li>
                            <li>Apply peer multiples to derive implied valuation range</li>
                            <li>Compare to current trading price - is it over/undervalued?</li>
                        </ol>
                    </div>
                </div>
            </div>

            <!-- Module 4 Quiz -->
            <div class="quiz-container">
                <h4>Module 4 Knowledge Check</h4>

                <div class="quiz-question">
                    <p>1. Why do we use Enterprise Value (EV) instead of Market Cap for EV/EBITDA multiples?</p>
                    <div class="quiz-options" id="quiz4-1">
                        <label class="quiz-option">
                            <input type="radio" name="q4-1" value="a">
                            EV is easier to calculate
                        </label>
                        <label class="quiz-option">
                            <input type="radio" name="q4-1" value="b">
                            EBITDA is pre-debt, so we need a capital-structure-neutral value measure
                        </label>
                        <label class="quiz-option">
                            <input type="radio" name="q4-1" value="c">
                            Market Cap excludes debt holders who also have a claim on EBITDA
                        </label>
                        <label class="quiz-option">
                            <input type="radio" name="q4-1" value="d">
                            Both B and C are correct
                        </label>
                    </div>
                </div>

                <div class="quiz-question">
                    <p>2. A company has EBITDA of $500M. Peers trade at 10x-14x EV/EBITDA with a median of 12x. Net debt is $1B. With 100M shares, what's the implied share price using the median multiple?</p>
                    <div class="quiz-options" id="quiz4-2">
                        <label class="quiz-option">
                            <input type="radio" name="q4-2" value="a">
                            $50 per share
                        </label>
                        <label class="quiz-option">
                            <input type="radio" name="q4-2" value="b">
                            $60 per share
                        </label>
                        <label class="quiz-option">
                            <input type="radio" name="q4-2" value="c">
                            $70 per share
                        </label>
                        <label class="quiz-option">
                            <input type="radio" name="q4-2" value="d">
                            $40 per share
                        </label>
                    </div>
                </div>

                <button class="submit-quiz" onclick="checkQuiz4()">Check Answers</button>
                <div class="quiz-feedback" id="quiz4-feedback"></div>
            </div>
        </div>

        <div class="module-container" id="module-4">
            <div class="module-header">
                <h2>Module 5: Probability & Statistical Analysis</h2>
                <p>Apply probability theory, statistical distributions, and Monte Carlo simulations to quantify investment risk and make data-driven decisions.</p>
            </div>

            <!-- Lesson 5.1: Probability Theory Fundamentals -->
            <div class="lesson-card">
                <h3>Lesson 5.1: Probability Theory for Investors</h3>
                <p>Understanding probability is fundamental to quantifying investment risk and expected returns. This lesson covers the mathematical foundations every analyst needs.</p>

                <h4>Core Probability Concepts</h4>
                <p><strong>Random Variables in Finance:</strong> Stock prices, returns, and financial metrics are random variables - their future values are uncertain. We characterize them using probability distributions.</p>

                <div class="key-concept">
                    <h4>Expected Value (E[X])</h4>
                    <p>The probability-weighted average of all possible outcomes. For discrete outcomes:</p>
                    <p style="text-align: center; font-family: monospace; font-size: 1.1em; margin: 15px 0;">
                        E[X] = Σ (xi × P(xi))
                    </p>
                    <p>For a stock with 40% chance of +20% return, 35% chance of +5%, and 25% chance of -15%:</p>
                    <p style="font-family: monospace; background: #f5f5f5; padding: 10px; border-radius: 4px;">
                        E[Return] = (0.40 × 0.20) + (0.35 × 0.05) + (0.25 × -0.15) = 5.875%
                    </p>
                </div>

                <div class="key-concept">
                    <h4>Variance and Standard Deviation</h4>
                    <p><strong>Variance (σ²)</strong> measures the dispersion of returns around the expected value:</p>
                    <p style="text-align: center; font-family: monospace; font-size: 1.1em; margin: 15px 0;">
                        Var(X) = E[(X - μ)²] = Σ P(xi) × (xi - μ)²
                    </p>
                    <p><strong>Standard Deviation (σ)</strong> = √Variance — In finance, this is called <strong>volatility</strong>.</p>
                </div>

                <h4>The Normal Distribution in Finance</h4>
                <p>Stock returns are often modeled using the normal (Gaussian) distribution, characterized by:</p>
                <ul>
                    <li><strong>Mean (μ):</strong> Average expected return</li>
                    <li><strong>Standard Deviation (σ):</strong> Volatility of returns</li>
                    <li><strong>68-95-99.7 Rule:</strong> 68% of returns fall within ±1σ, 95% within ±2σ, 99.7% within ±3σ</li>
                </ul>

                <div class="code-block">
                    <div class="code-header">
                        <span class="code-lang">Python</span>
                        <span>Calculate Return Statistics</span>
                    </div>
                    <pre>import numpy as np
import pandas as pd
import yfinance as yf
from scipy import stats

def calculate_return_statistics(ticker, period='5y'):
    """
    Calculate comprehensive return statistics for a stock.

    Parameters:
    -----------
    ticker : str
        Stock ticker symbol
    period : str
        Historical period ('1y', '2y', '5y', '10y')

    Returns:
    --------
    dict : Dictionary containing all statistical measures
    """
    # Download historical data
    stock = yf.Ticker(ticker)
    hist = stock.history(period=period)

    # Calculate daily returns
    returns = hist['Close'].pct_change().dropna()

    # Basic statistics
    stats_dict = {
        'ticker': ticker,
        'observations': len(returns),
        'mean_daily': returns.mean(),
        'mean_annual': returns.mean() * 252,  # Annualized
        'std_daily': returns.std(),
        'std_annual': returns.std() * np.sqrt(252),  # Annualized volatility
        'variance_daily': returns.var(),
        'min_return': returns.min(),
        'max_return': returns.max(),
        'median': returns.median(),
    }

    # Higher moments
    stats_dict['skewness'] = returns.skew()  # Asymmetry
    stats_dict['kurtosis'] = returns.kurtosis()  # Tail thickness

    # Probability of loss on any given day
    stats_dict['prob_negative_day'] = (returns < 0).mean()

    # Probability of >2% loss (approximately 2 std devs)
    stats_dict['prob_2pct_loss'] = (returns < -0.02).mean()

    # Value at Risk (95% confidence)
    stats_dict['var_95'] = np.percentile(returns, 5)
    stats_dict['var_99'] = np.percentile(returns, 1)

    return stats_dict

# Example usage
stats = calculate_return_statistics('AAPL', '5y')
print(f"\n{'='*50}")
print(f"Return Statistics for {stats['ticker']}")
print(f"{'='*50}")
print(f"Observations: {stats['observations']} trading days")
print(f"\nCentral Tendency:")
print(f"  Mean Daily Return: {stats['mean_daily']:.4%}")
print(f"  Mean Annual Return: {stats['mean_annual']:.2%}")
print(f"  Median Daily Return: {stats['median']:.4%}")
print(f"\nVolatility (Risk):")
print(f"  Daily Std Dev: {stats['std_daily']:.4%}")
print(f"  Annual Volatility: {stats['std_annual']:.2%}")
print(f"\nDistribution Shape:")
print(f"  Skewness: {stats['skewness']:.4f}")
print(f"  Kurtosis: {stats['kurtosis']:.4f}")
print(f"\nRisk Metrics:")
print(f"  Prob of Negative Day: {stats['prob_negative_day']:.1%}")
print(f"  Prob of >2% Loss: {stats['prob_2pct_loss']:.1%}")
print(f"  VaR (95%): {stats['var_95']:.2%}")
print(f"  VaR (99%): {stats['var_99']:.2%}")</pre>
                </div>

                <div class="code-block">
                    <div class="code-header">
                        <span class="code-lang">R</span>
                        <span>Return Distribution Analysis</span>
                    </div>
                    <pre>library(quantmod)
library(moments)
library(ggplot2)

calculate_return_stats <- function(ticker, years = 5) {
  # Download data
  getSymbols(ticker, src = "yahoo",
             from = Sys.Date() - years * 365,
             auto.assign = FALSE) -> stock_data

  # Calculate daily returns
  returns <- dailyReturn(Cl(stock_data))
  returns <- na.omit(returns)

  # Calculate statistics
  stats <- list(
    ticker = ticker,
    n_obs = length(returns),
    mean_daily = mean(returns),
    mean_annual = mean(returns) * 252,
    sd_daily = sd(returns),
    sd_annual = sd(returns) * sqrt(252),
    skewness = skewness(returns),
    kurtosis = kurtosis(returns) - 3,  # Excess kurtosis
    var_95 = quantile(returns, 0.05),
    var_99 = quantile(returns, 0.01)
  )

  return(stats)
}

# Visualize return distribution
plot_return_distribution <- function(ticker, years = 5) {
  getSymbols(ticker, src = "yahoo",
             from = Sys.Date() - years * 365,
             auto.assign = FALSE) -> stock_data

  returns <- as.numeric(dailyReturn(Cl(stock_data)))
  returns <- na.omit(returns)

  # Create histogram with normal overlay
  df <- data.frame(returns = returns)

  ggplot(df, aes(x = returns)) +
    geom_histogram(aes(y = ..density..), bins = 50,
                   fill = "#3498db", alpha = 0.7) +
    stat_function(fun = dnorm,
                  args = list(mean = mean(returns), sd = sd(returns)),
                  color = "#e74c3c", size = 1.2) +
    labs(title = paste("Return Distribution:", ticker),
         subtitle = "Blue: Actual | Red: Normal Distribution",
         x = "Daily Return", y = "Density") +
    theme_minimal() +
    geom_vline(xintercept = mean(returns),
               linetype = "dashed", color = "#2c3e50")
}

# Example
stats <- calculate_return_stats("AAPL", 5)
print(stats)
plot_return_distribution("AAPL", 5)</pre>
                </div>

                <h4>Interpreting Skewness and Kurtosis</h4>
                <table>
                    <thead>
                        <tr>
                            <th>Metric</th>
                            <th>Value</th>
                            <th>Interpretation</th>
                            <th>Investment Implication</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Skewness = 0</td>
                            <td>Symmetric</td>
                            <td>Equal upside/downside</td>
                            <td>Normal risk profile</td>
                        </tr>
                        <tr>
                            <td>Skewness < 0</td>
                            <td>Left-skewed</td>
                            <td>Larger downside tail</td>
                            <td>Higher crash risk</td>
                        </tr>
                        <tr>
                            <td>Skewness > 0</td>
                            <td>Right-skewed</td>
                            <td>Larger upside tail</td>
                            <td>Lottery-like payoffs</td>
                        </tr>
                        <tr>
                            <td>Kurtosis = 3</td>
                            <td>Mesokurtic</td>
                            <td>Normal tails</td>
                            <td>Standard risk</td>
                        </tr>
                        <tr>
                            <td>Kurtosis > 3</td>
                            <td>Leptokurtic</td>
                            <td>Fat tails</td>
                            <td>More extreme events</td>
                        </tr>
                        <tr>
                            <td>Kurtosis < 3</td>
                            <td>Platykurtic</td>
                            <td>Thin tails</td>
                            <td>Fewer extreme events</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Lesson 5.2: Hypothesis Testing -->
            <div class="lesson-card">
                <h3>Lesson 5.2: Hypothesis Testing for Investment Decisions</h3>
                <p>Hypothesis testing allows us to make statistically rigorous claims about stock performance, strategy effectiveness, and market behavior.</p>

                <h4>Key Statistical Tests for Finance</h4>

                <div class="key-concept">
                    <h4>1. Testing if Returns Differ from Zero (One-Sample t-Test)</h4>
                    <p>Does a stock generate statistically significant positive returns?</p>
                    <ul>
                        <li><strong>H₀ (Null):</strong> μ = 0 (no significant return)</li>
                        <li><strong>H₁ (Alternative):</strong> μ ≠ 0 (significant return)</li>
                        <li><strong>Decision Rule:</strong> Reject H₀ if p-value < 0.05</li>
                    </ul>
                </div>

                <div class="key-concept">
                    <h4>2. Comparing Two Stocks (Two-Sample t-Test)</h4>
                    <p>Is Stock A's performance significantly different from Stock B?</p>
                    <ul>
                        <li><strong>H₀:</strong> μ_A = μ_B (no difference)</li>
                        <li><strong>H₁:</strong> μ_A ≠ μ_B (significant difference)</li>
                    </ul>
                </div>

                <div class="key-concept">
                    <h4>3. Testing for Normality (Jarque-Bera Test)</h4>
                    <p>Are returns normally distributed? Important for VaR calculations.</p>
                    <ul>
                        <li><strong>H₀:</strong> Returns are normally distributed</li>
                        <li><strong>H₁:</strong> Returns are NOT normally distributed</li>
                        <li><strong>Implication:</strong> If rejected, use non-parametric methods</li>
                    </ul>
                </div>

                <div class="code-block">
                    <div class="code-header">
                        <span class="code-lang">Python</span>
                        <span>Comprehensive Hypothesis Testing Suite</span>
                    </div>
                    <pre>import numpy as np
import pandas as pd
import yfinance as yf
from scipy import stats
from scipy.stats import jarque_bera, shapiro, ttest_1samp, ttest_ind

class HypothesisTester:
    """
    Statistical hypothesis testing for investment analysis.
    """

    def __init__(self, ticker, benchmark='SPY', period='5y'):
        self.ticker = ticker
        self.benchmark = benchmark
        self.period = period
        self._load_data()

    def _load_data(self):
        """Load stock and benchmark data."""
        stock = yf.Ticker(self.ticker)
        bench = yf.Ticker(self.benchmark)

        stock_hist = stock.history(period=self.period)
        bench_hist = bench.history(period=self.period)

        self.stock_returns = stock_hist['Close'].pct_change().dropna()
        self.bench_returns = bench_hist['Close'].pct_change().dropna()

        # Align dates
        common_dates = self.stock_returns.index.intersection(self.bench_returns.index)
        self.stock_returns = self.stock_returns.loc[common_dates]
        self.bench_returns = self.bench_returns.loc[common_dates]

    def test_positive_returns(self, alpha=0.05):
        """
        Test if stock generates statistically significant positive returns.
        H0: mean return = 0
        H1: mean return > 0 (one-tailed)
        """
        t_stat, p_value = ttest_1samp(self.stock_returns, 0)
        p_one_tail = p_value / 2  # Convert to one-tailed

        result = {
            'test': 'One-Sample t-Test (Positive Returns)',
            'null_hypothesis': 'Mean return = 0',
            'alternative': 'Mean return > 0',
            't_statistic': t_stat,
            'p_value': p_one_tail,
            'alpha': alpha,
            'reject_null': p_one_tail < alpha and t_stat > 0,
            'conclusion': ''
        }

        if result['reject_null']:
            result['conclusion'] = f"{self.ticker} generates statistically significant positive returns (p={p_one_tail:.4f})"
        else:
            result['conclusion'] = f"Cannot confirm {self.ticker} generates significant positive returns (p={p_one_tail:.4f})"

        return result

    def test_beats_benchmark(self, alpha=0.05):
        """
        Test if stock outperforms benchmark.
        H0: stock_return = benchmark_return
        H1: stock_return > benchmark_return
        """
        # Calculate excess returns
        excess_returns = self.stock_returns - self.bench_returns

        t_stat, p_value = ttest_1samp(excess_returns, 0)
        p_one_tail = p_value / 2

        result = {
            'test': 'Outperformance Test vs Benchmark',
            'null_hypothesis': f'{self.ticker} return = {self.benchmark} return',
            'alternative': f'{self.ticker} return > {self.benchmark} return',
            'mean_excess_return_daily': excess_returns.mean(),
            'mean_excess_return_annual': excess_returns.mean() * 252,
            't_statistic': t_stat,
            'p_value': p_one_tail,
            'reject_null': p_one_tail < alpha and t_stat > 0,
            'conclusion': ''
        }

        if result['reject_null']:
            result['conclusion'] = f"{self.ticker} significantly outperforms {self.benchmark} (p={p_one_tail:.4f})"
        else:
            result['conclusion'] = f"Cannot confirm {self.ticker} outperforms {self.benchmark} (p={p_one_tail:.4f})"

        return result

    def test_normality(self, alpha=0.05):
        """
        Test if returns follow a normal distribution.
        Uses Jarque-Bera test (good for large samples).
        """
        jb_stat, jb_p = jarque_bera(self.stock_returns)

        # Also run Shapiro-Wilk for comparison (sample limit 5000)
        sample = self.stock_returns[:5000] if len(self.stock_returns) > 5000 else self.stock_returns
        sw_stat, sw_p = shapiro(sample)

        result = {
            'test': 'Normality Tests',
            'null_hypothesis': 'Returns are normally distributed',
            'jarque_bera_stat': jb_stat,
            'jarque_bera_p': jb_p,
            'shapiro_wilk_stat': sw_stat,
            'shapiro_wilk_p': sw_p,
            'skewness': self.stock_returns.skew(),
            'kurtosis': self.stock_returns.kurtosis(),
            'reject_null': jb_p < alpha,
            'conclusion': ''
        }

        if result['reject_null']:
            result['conclusion'] = f"Returns are NOT normally distributed (p={jb_p:.4f}). Use non-parametric methods."
        else:
            result['conclusion'] = f"Cannot reject normality assumption (p={jb_p:.4f}). Parametric methods OK."

        return result

    def test_volatility_difference(self, other_ticker, alpha=0.05):
        """
        Test if two stocks have different volatilities using Levene's test.
        """
        other = yf.Ticker(other_ticker)
        other_hist = other.history(period=self.period)
        other_returns = other_hist['Close'].pct_change().dropna()

        stat, p_value = stats.levene(self.stock_returns, other_returns)

        result = {
            'test': 'Volatility Comparison (Levene Test)',
            'null_hypothesis': f'Volatility({self.ticker}) = Volatility({other_ticker})',
            'stock1_volatility': self.stock_returns.std() * np.sqrt(252),
            'stock2_volatility': other_returns.std() * np.sqrt(252),
            'test_statistic': stat,
            'p_value': p_value,
            'reject_null': p_value < alpha,
            'conclusion': ''
        }

        if result['reject_null']:
            result['conclusion'] = f"Volatilities are significantly different (p={p_value:.4f})"
        else:
            result['conclusion'] = f"No significant difference in volatility (p={p_value:.4f})"

        return result

    def run_all_tests(self):
        """Run comprehensive test suite."""
        print(f"\n{'='*60}")
        print(f"HYPOTHESIS TESTING REPORT: {self.ticker}")
        print(f"Benchmark: {self.benchmark} | Period: {self.period}")
        print(f"{'='*60}\n")

        tests = [
            self.test_positive_returns(),
            self.test_beats_benchmark(),
            self.test_normality()
        ]

        for test in tests:
            print(f"TEST: {test['test']}")
            print(f"  H₀: {test['null_hypothesis']}")
            print(f"  p-value: {test['p_value']:.4f}")
            print(f"  Reject H₀: {'Yes' if test['reject_null'] else 'No'}")
            print(f"  → {test['conclusion']}")
            print()

        return tests

# Example usage
tester = HypothesisTester('NVDA', 'SPY', '3y')
results = tester.run_all_tests()

# Compare volatility with another stock
vol_test = tester.test_volatility_difference('AAPL')
print(f"TEST: {vol_test['test']}")
print(f"  NVDA Volatility: {vol_test['stock1_volatility']:.1%}")
print(f"  AAPL Volatility: {vol_test['stock2_volatility']:.1%}")
print(f"  → {vol_test['conclusion']}")</pre>
                </div>

                <div class="code-block">
                    <div class="code-header">
                        <span class="code-lang">R</span>
                        <span>Statistical Testing in R</span>
                    </div>
                    <pre>library(quantmod)
library(tseries)  # For Jarque-Bera test

# Function to perform comprehensive hypothesis tests
run_hypothesis_tests <- function(ticker, benchmark = "SPY", years = 3) {

  # Download data
  getSymbols(c(ticker, benchmark), src = "yahoo",
             from = Sys.Date() - years * 365)

  # Calculate returns
  stock_returns <- na.omit(dailyReturn(Cl(get(ticker))))
  bench_returns <- na.omit(dailyReturn(Cl(get(benchmark))))

  # Align dates
  merged <- merge(stock_returns, bench_returns)
  merged <- na.omit(merged)
  stock_ret <- as.numeric(merged[,1])
  bench_ret <- as.numeric(merged[,2])

  cat("\n", paste(rep("=", 60), collapse=""), "\n")
  cat("HYPOTHESIS TESTING REPORT:", ticker, "\n")
  cat(paste(rep("=", 60), collapse=""), "\n\n")

  # Test 1: Positive returns
  cat("TEST 1: Does stock generate positive returns?\n")
  t_test_pos <- t.test(stock_ret, mu = 0, alternative = "greater")
  cat("  H0: Mean return = 0\n")
  cat("  t-statistic:", round(t_test_pos$statistic, 4), "\n")
  cat("  p-value:", round(t_test_pos$p.value, 4), "\n")
  cat("  Conclusion:", ifelse(t_test_pos$p.value < 0.05,
      "Significant positive returns", "Cannot confirm positive returns"), "\n\n")

  # Test 2: Outperformance vs benchmark
  cat("TEST 2: Does stock outperform", benchmark, "?\n")
  excess_ret <- stock_ret - bench_ret
  t_test_excess <- t.test(excess_ret, mu = 0, alternative = "greater")
  cat("  H0: Excess return = 0\n")
  cat("  Mean excess return (annual):",
      round(mean(excess_ret) * 252 * 100, 2), "%\n")
  cat("  p-value:", round(t_test_excess$p.value, 4), "\n")
  cat("  Conclusion:", ifelse(t_test_excess$p.value < 0.05,
      "Significant outperformance", "Cannot confirm outperformance"), "\n\n")

  # Test 3: Normality
  cat("TEST 3: Are returns normally distributed?\n")
  jb_test <- jarque.bera.test(stock_ret)
  cat("  H0: Returns are normal\n")
  cat("  Jarque-Bera statistic:", round(jb_test$statistic, 4), "\n")
  cat("  p-value:", round(jb_test$p.value, 4), "\n")
  cat("  Skewness:", round(skewness(stock_ret), 4), "\n")
  cat("  Kurtosis:", round(kurtosis(stock_ret), 4), "\n")
  cat("  Conclusion:", ifelse(jb_test$p.value < 0.05,
      "NOT normal - use non-parametric methods",
      "Normal assumption OK"), "\n\n")

  # Test 4: Volatility comparison
  cat("TEST 4: Volatility comparison with", benchmark, "\n")
  var_test <- var.test(stock_ret, bench_ret)
  cat("  Stock volatility:", round(sd(stock_ret) * sqrt(252) * 100, 1), "%\n")
  cat("  Benchmark volatility:", round(sd(bench_ret) * sqrt(252) * 100, 1), "%\n")
  cat("  F-statistic:", round(var_test$statistic, 4), "\n")
  cat("  p-value:", round(var_test$p.value, 4), "\n")
  cat("  Conclusion:", ifelse(var_test$p.value < 0.05,
      "Significantly different volatility",
      "Similar volatility"), "\n")
}

# Run tests
run_hypothesis_tests("NVDA", "SPY", 3)</pre>
                </div>
            </div>

            <!-- Lesson 5.3: Monte Carlo Simulation -->
            <div class="lesson-card">
                <h3>Lesson 5.3: Monte Carlo Simulation for Stock Analysis</h3>
                <p>Monte Carlo simulation uses random sampling to model uncertainty and generate thousands of possible future scenarios. It's essential for risk analysis, option pricing, and portfolio optimization.</p>

                <h4>How Monte Carlo Works for Stock Prices</h4>
                <ol>
                    <li><strong>Model the Process:</strong> Stock prices follow Geometric Brownian Motion (GBM):
                        <p style="font-family: monospace; text-align: center; margin: 15px 0; font-size: 1.1em;">
                            S(t+Δt) = S(t) × exp[(μ - σ²/2)Δt + σ × √Δt × Z]
                        </p>
                        Where Z is a random draw from N(0,1)
                    </li>
                    <li><strong>Calibrate Parameters:</strong> Estimate μ (drift) and σ (volatility) from historical data</li>
                    <li><strong>Simulate Paths:</strong> Generate thousands of possible price trajectories</li>
                    <li><strong>Analyze Distribution:</strong> Calculate statistics across all simulations</li>
                </ol>

                <div class="key-concept">
                    <h4>Applications of Monte Carlo in Finance</h4>
                    <ul>
                        <li><strong>Price Forecasting:</strong> Generate probability distributions of future prices</li>
                        <li><strong>Value at Risk (VaR):</strong> Estimate potential losses at confidence levels</li>
                        <li><strong>Option Pricing:</strong> Price complex derivatives</li>
                        <li><strong>Portfolio Risk:</strong> Simulate correlated asset movements</li>
                        <li><strong>Retirement Planning:</strong> Model sequence of returns risk</li>
                    </ul>
                </div>

                <div class="code-block">
                    <div class="code-header">
                        <span class="code-lang">Python</span>
                        <span>Complete Monte Carlo Stock Simulator</span>
                    </div>
                    <pre>import numpy as np
import pandas as pd
import yfinance as yf
import matplotlib.pyplot as plt
from scipy import stats

class MonteCarloStockSimulator:
    """
    Monte Carlo simulation engine for stock price forecasting.
    """

    def __init__(self, ticker, lookback_years=5):
        self.ticker = ticker
        self.lookback_years = lookback_years
        self._load_and_calibrate()

    def _load_and_calibrate(self):
        """Load historical data and calibrate model parameters."""
        stock = yf.Ticker(self.ticker)
        hist = stock.history(period=f'{self.lookback_years}y')

        self.current_price = hist['Close'].iloc[-1]
        self.returns = hist['Close'].pct_change().dropna()

        # Calibrate parameters (annualized)
        self.mu = self.returns.mean() * 252  # Annual drift
        self.sigma = self.returns.std() * np.sqrt(252)  # Annual volatility

        print(f"Calibrated {self.ticker}:")
        print(f"  Current Price: ${self.current_price:.2f}")
        print(f"  Annual Drift (μ): {self.mu:.2%}")
        print(f"  Annual Volatility (σ): {self.sigma:.2%}")

    def simulate_gbm(self, days=252, n_simulations=10000, seed=None):
        """
        Simulate stock prices using Geometric Brownian Motion.

        Parameters:
        -----------
        days : int
            Number of trading days to simulate (252 = 1 year)
        n_simulations : int
            Number of Monte Carlo paths
        seed : int
            Random seed for reproducibility

        Returns:
        --------
        np.array : Matrix of simulated prices (days x n_simulations)
        """
        if seed:
            np.random.seed(seed)

        dt = 1/252  # Daily time step

        # Initialize price matrix
        prices = np.zeros((days + 1, n_simulations))
        prices[0] = self.current_price

        # Generate random shocks
        Z = np.random.standard_normal((days, n_simulations))

        # Simulate GBM
        for t in range(1, days + 1):
            prices[t] = prices[t-1] * np.exp(
                (self.mu - 0.5 * self.sigma**2) * dt +
                self.sigma * np.sqrt(dt) * Z[t-1]
            )

        self.simulated_prices = prices
        self.simulation_days = days
        self.n_simulations = n_simulations

        return prices

    def get_price_statistics(self, confidence_levels=[0.05, 0.25, 0.50, 0.75, 0.95]):
        """Calculate price statistics at simulation end."""
        final_prices = self.simulated_prices[-1]

        stats_dict = {
            'mean': np.mean(final_prices),
            'median': np.median(final_prices),
            'std': np.std(final_prices),
            'min': np.min(final_prices),
            'max': np.max(final_prices),
        }

        for level in confidence_levels:
            stats_dict[f'percentile_{int(level*100)}'] = np.percentile(final_prices, level*100)

        return stats_dict

    def calculate_var(self, horizon_days=21, confidence=0.95):
        """
        Calculate Value at Risk.

        Parameters:
        -----------
        horizon_days : int
            Risk horizon (21 days ≈ 1 month)
        confidence : float
            Confidence level (0.95 = 95%)

        Returns:
        --------
        dict : VaR metrics
        """
        # Simulate if not already done
        if not hasattr(self, 'simulated_prices'):
            self.simulate_gbm(days=horizon_days)

        # Get prices at horizon
        horizon_prices = self.simulated_prices[min(horizon_days, self.simulation_days)]

        # Calculate returns
        returns = (horizon_prices - self.current_price) / self.current_price

        # VaR is the loss at the (1-confidence) percentile
        var_pct = np.percentile(returns, (1-confidence) * 100)
        var_dollar = self.current_price * abs(var_pct)

        # Conditional VaR (Expected Shortfall)
        cvar_returns = returns[returns <= var_pct]
        cvar_pct = np.mean(cvar_returns) if len(cvar_returns) > 0 else var_pct
        cvar_dollar = self.current_price * abs(cvar_pct)

        return {
            'horizon_days': horizon_days,
            'confidence': confidence,
            'var_percent': var_pct,
            'var_dollar': var_dollar,
            'cvar_percent': cvar_pct,
            'cvar_dollar': cvar_dollar,
            'prob_loss': (returns < 0).mean(),
            'prob_10pct_loss': (returns < -0.10).mean(),
            'prob_20pct_loss': (returns < -0.20).mean()
        }

    def probability_target(self, target_price, days=252):
        """Calculate probability of reaching a target price."""
        if not hasattr(self, 'simulated_prices') or self.simulation_days != days:
            self.simulate_gbm(days=days)

        final_prices = self.simulated_prices[-1]
        prob_above = (final_prices >= target_price).mean()
        prob_below = (final_prices <= target_price).mean()

        return {
            'target_price': target_price,
            'current_price': self.current_price,
            'required_return': (target_price - self.current_price) / self.current_price,
            'days': days,
            'prob_reach_target': prob_above,
            'prob_below_target': prob_below,
            'median_final_price': np.median(final_prices),
            'expected_final_price': np.mean(final_prices)
        }

    def plot_simulation(self, n_paths_show=100):
        """Visualize Monte Carlo simulation."""
        fig, axes = plt.subplots(2, 2, figsize=(14, 10))

        # Plot 1: Sample paths
        ax1 = axes[0, 0]
        days = np.arange(self.simulated_prices.shape[0])

        # Plot subset of paths
        for i in range(min(n_paths_show, self.n_simulations)):
            ax1.plot(days, self.simulated_prices[:, i], alpha=0.1, color='blue')

        # Plot percentile bands
        percentiles = [5, 25, 50, 75, 95]
        for p in percentiles:
            ax1.plot(days, np.percentile(self.simulated_prices, p, axis=1),
                    linewidth=2, label=f'{p}th percentile')

        ax1.axhline(y=self.current_price, color='black', linestyle='--', label='Current')
        ax1.set_xlabel('Trading Days')
        ax1.set_ylabel('Price ($)')
        ax1.set_title(f'{self.ticker} Monte Carlo Simulation ({self.n_simulations:,} paths)')
        ax1.legend(loc='upper left')

        # Plot 2: Final price distribution
        ax2 = axes[0, 1]
        final_prices = self.simulated_prices[-1]
        ax2.hist(final_prices, bins=50, density=True, alpha=0.7, color='#3498db')
        ax2.axvline(x=self.current_price, color='red', linestyle='--',
                   label=f'Current: ${self.current_price:.2f}')
        ax2.axvline(x=np.mean(final_prices), color='green', linestyle='-',
                   label=f'Mean: ${np.mean(final_prices):.2f}')
        ax2.axvline(x=np.median(final_prices), color='orange', linestyle='-',
                   label=f'Median: ${np.median(final_prices):.2f}')
        ax2.set_xlabel('Final Price ($)')
        ax2.set_ylabel('Density')
        ax2.set_title('Distribution of Final Prices')
        ax2.legend()

        # Plot 3: Return distribution
        ax3 = axes[1, 0]
        returns = (final_prices - self.current_price) / self.current_price
        ax3.hist(returns * 100, bins=50, density=True, alpha=0.7, color='#2ecc71')
        ax3.axvline(x=0, color='red', linestyle='--')
        ax3.axvline(x=np.mean(returns)*100, color='blue', linestyle='-',
                   label=f'Mean: {np.mean(returns)*100:.1f}%')
        ax3.set_xlabel('Return (%)')
        ax3.set_ylabel('Density')
        ax3.set_title('Distribution of Returns')
        ax3.legend()

        # Plot 4: Probability cone
        ax4 = axes[1, 1]
        days_axis = np.arange(self.simulated_prices.shape[0])

        p5 = np.percentile(self.simulated_prices, 5, axis=1)
        p25 = np.percentile(self.simulated_prices, 25, axis=1)
        p75 = np.percentile(self.simulated_prices, 75, axis=1)
        p95 = np.percentile(self.simulated_prices, 95, axis=1)
        median = np.percentile(self.simulated_prices, 50, axis=1)

        ax4.fill_between(days_axis, p5, p95, alpha=0.2, color='blue', label='90% CI')
        ax4.fill_between(days_axis, p25, p75, alpha=0.4, color='blue', label='50% CI')
        ax4.plot(days_axis, median, color='blue', linewidth=2, label='Median')
        ax4.axhline(y=self.current_price, color='red', linestyle='--', label='Current')
        ax4.set_xlabel('Trading Days')
        ax4.set_ylabel('Price ($)')
        ax4.set_title('Probability Cone')
        ax4.legend()

        plt.tight_layout()
        plt.savefig(f'{self.ticker}_monte_carlo.png', dpi=150)
        plt.show()

        return fig

# Example usage
print("="*60)
print("MONTE CARLO STOCK SIMULATION")
print("="*60)

# Initialize simulator
mc = MonteCarloStockSimulator('AAPL', lookback_years=5)

# Run simulation (1 year, 10000 paths)
prices = mc.simulate_gbm(days=252, n_simulations=10000, seed=42)

# Get statistics
stats = mc.get_price_statistics()
print(f"\n1-Year Price Forecast:")
print(f"  Mean: ${stats['mean']:.2f}")
print(f"  Median: ${stats['median']:.2f}")
print(f"  5th Percentile: ${stats['percentile_5']:.2f}")
print(f"  95th Percentile: ${stats['percentile_95']:.2f}")

# Calculate VaR
var = mc.calculate_var(horizon_days=21, confidence=0.95)
print(f"\n21-Day Value at Risk (95% confidence):")
print(f"  VaR: {var['var_percent']:.2%} (${var['var_dollar']:.2f})")
print(f"  CVaR (Expected Shortfall): {var['cvar_percent']:.2%}")
print(f"  Probability of Loss: {var['prob_loss']:.1%}")
print(f"  Probability of >10% Loss: {var['prob_10pct_loss']:.1%}")

# Target price analysis
target = mc.probability_target(target_price=250, days=252)
print(f"\nTarget Price Analysis (${target['target_price']}):")
print(f"  Required Return: {target['required_return']:.1%}")
print(f"  Probability of Reaching Target: {target['prob_reach_target']:.1%}")

# Visualize
mc.plot_simulation()</pre>
                </div>

                <div class="code-block">
                    <div class="code-header">
                        <span class="code-lang">R</span>
                        <span>Monte Carlo Simulation in R</span>
                    </div>
                    <pre>library(quantmod)
library(ggplot2)
library(tidyr)

monte_carlo_simulation <- function(ticker, days = 252,
                                    n_sims = 10000,
                                    lookback_years = 5) {

  # Download historical data
  getSymbols(ticker, src = "yahoo",
             from = Sys.Date() - lookback_years * 365,
             auto.assign = FALSE) -> stock_data

  # Calculate returns and parameters
  returns <- na.omit(dailyReturn(Cl(stock_data)))
  current_price <- as.numeric(last(Cl(stock_data)))

  mu <- mean(returns) * 252  # Annual drift
  sigma <- sd(returns) * sqrt(252)  # Annual volatility

  cat("Calibrated Parameters:\n")
  cat("  Current Price: $", round(current_price, 2), "\n")
  cat("  Annual Drift (μ):", round(mu * 100, 2), "%\n")
  cat("  Annual Volatility (σ):", round(sigma * 100, 2), "%\n")

  # GBM Simulation
  dt <- 1/252

  # Initialize price matrix
  prices <- matrix(0, nrow = days + 1, ncol = n_sims)
  prices[1,] <- current_price

  # Generate random shocks and simulate
  set.seed(42)
  for (t in 2:(days + 1)) {
    Z <- rnorm(n_sims)
    prices[t,] <- prices[t-1,] * exp((mu - 0.5 * sigma^2) * dt +
                                       sigma * sqrt(dt) * Z)
  }

  # Calculate statistics
  final_prices <- prices[days + 1,]

  results <- list(
    prices = prices,
    final_prices = final_prices,
    current_price = current_price,
    mean_final = mean(final_prices),
    median_final = median(final_prices),
    sd_final = sd(final_prices),
    percentile_5 = quantile(final_prices, 0.05),
    percentile_95 = quantile(final_prices, 0.95),
    prob_gain = mean(final_prices > current_price),
    prob_loss_10pct = mean(final_prices < current_price * 0.9)
  )

  return(results)
}

# Value at Risk calculation
calculate_var <- function(mc_results, horizon_days = 21, confidence = 0.95) {

  horizon_prices <- mc_results$prices[horizon_days + 1,]
  returns <- (horizon_prices - mc_results$current_price) / mc_results$current_price

  var_pct <- quantile(returns, 1 - confidence)
  var_dollar <- mc_results$current_price * abs(var_pct)

  # Conditional VaR
  cvar_returns <- returns[returns <= var_pct]
  cvar_pct <- mean(cvar_returns)
  cvar_dollar <- mc_results$current_price * abs(cvar_pct)

  return(list(
    var_pct = var_pct,
    var_dollar = var_dollar,
    cvar_pct = cvar_pct,
    cvar_dollar = cvar_dollar
  ))
}

# Plotting function
plot_monte_carlo <- function(mc_results, ticker, n_paths_show = 100) {

  prices <- mc_results$prices
  days <- 0:(nrow(prices) - 1)

  # Convert to data frame for ggplot
  # Sample paths for visualization
  sample_idx <- sample(ncol(prices), min(n_paths_show, ncol(prices)))

  df_paths <- data.frame(
    day = rep(days, length(sample_idx)),
    price = as.vector(prices[, sample_idx]),
    path = rep(1:length(sample_idx), each = length(days))
  )

  # Calculate percentiles
  df_percentiles <- data.frame(
    day = days,
    p5 = apply(prices, 1, quantile, 0.05),
    p25 = apply(prices, 1, quantile, 0.25),
    p50 = apply(prices, 1, quantile, 0.50),
    p75 = apply(prices, 1, quantile, 0.75),
    p95 = apply(prices, 1, quantile, 0.95)
  )

  # Create plot
  p <- ggplot() +
    geom_ribbon(data = df_percentiles,
                aes(x = day, ymin = p5, ymax = p95),
                alpha = 0.2, fill = "blue") +
    geom_ribbon(data = df_percentiles,
                aes(x = day, ymin = p25, ymax = p75),
                alpha = 0.3, fill = "blue") +
    geom_line(data = df_percentiles,
              aes(x = day, y = p50),
              color = "blue", size = 1.2) +
    geom_hline(yintercept = mc_results$current_price,
               linetype = "dashed", color = "red") +
    labs(title = paste("Monte Carlo Simulation:", ticker),
         subtitle = paste(ncol(prices), "simulations"),
         x = "Trading Days",
         y = "Price ($)") +
    theme_minimal()

  print(p)

  # Final price histogram
  df_final <- data.frame(price = mc_results$final_prices)

  p2 <- ggplot(df_final, aes(x = price)) +
    geom_histogram(bins = 50, fill = "#3498db", alpha = 0.7) +
    geom_vline(xintercept = mc_results$current_price,
               color = "red", linetype = "dashed", size = 1) +
    geom_vline(xintercept = mc_results$mean_final,
               color = "green", size = 1) +
    labs(title = "Distribution of Final Prices",
         x = "Price ($)", y = "Frequency") +
    theme_minimal()

  print(p2)
}

# Run simulation
mc <- monte_carlo_simulation("AAPL", days = 252, n_sims = 10000)

cat("\n1-Year Price Forecast:\n")
cat("  Mean: $", round(mc$mean_final, 2), "\n")
cat("  Median: $", round(mc$median_final, 2), "\n")
cat("  5th Percentile: $", round(mc$percentile_5, 2), "\n")
cat("  95th Percentile: $", round(mc$percentile_95, 2), "\n")
cat("  Prob of Gain:", round(mc$prob_gain * 100, 1), "%\n")

# Calculate VaR
var_results <- calculate_var(mc, horizon_days = 21)
cat("\n21-Day VaR (95%):", round(var_results$var_pct * 100, 2), "%\n")
cat("CVaR:", round(var_results$cvar_pct * 100, 2), "%\n")

# Plot results
plot_monte_carlo(mc, "AAPL")</pre>
                </div>
            </div>

            <!-- Lesson 5.4: Portfolio Risk Analysis -->
            <div class="lesson-card">
                <h3>Lesson 5.4: Portfolio Risk Analysis & Correlation</h3>
                <p>Understanding how assets move together (correlation) is crucial for building diversified portfolios that reduce risk without sacrificing returns.</p>

                <h4>Correlation in Portfolio Theory</h4>
                <div class="key-concept">
                    <h4>Correlation Coefficient (ρ)</h4>
                    <p>Measures the linear relationship between two assets' returns:</p>
                    <ul>
                        <li><strong>ρ = +1:</strong> Perfect positive correlation (move together)</li>
                        <li><strong>ρ = 0:</strong> No linear relationship</li>
                        <li><strong>ρ = -1:</strong> Perfect negative correlation (move opposite)</li>
                    </ul>
                    <p><strong>Diversification Benefit:</strong> When ρ < 1, combining assets reduces portfolio volatility below the weighted average of individual volatilities.</p>
                </div>

                <h4>Portfolio Variance Formula (Two Assets)</h4>
                <p style="font-family: monospace; text-align: center; margin: 20px 0; font-size: 1.05em; background: #f5f5f5; padding: 15px; border-radius: 4px;">
                    σ²_portfolio = w₁²σ₁² + w₂²σ₂² + 2w₁w₂σ₁σ₂ρ₁₂
                </p>

                <div class="code-block">
                    <div class="code-header">
                        <span class="code-lang">Python</span>
                        <span>Portfolio Risk Analysis Engine</span>
                    </div>
                    <pre>import numpy as np
import pandas as pd
import yfinance as yf
import matplotlib.pyplot as plt
import seaborn as sns
from scipy.optimize import minimize

class PortfolioRiskAnalyzer:
    """
    Comprehensive portfolio risk analysis toolkit.
    """

    def __init__(self, tickers, period='5y'):
        self.tickers = tickers
        self.period = period
        self._load_data()

    def _load_data(self):
        """Download and process price data."""
        prices = pd.DataFrame()

        for ticker in self.tickers:
            stock = yf.Ticker(ticker)
            hist = stock.history(period=self.period)
            prices[ticker] = hist['Close']

        # Calculate daily returns
        self.returns = prices.pct_change().dropna()
        self.prices = prices

        # Annualized statistics
        self.mean_returns = self.returns.mean() * 252
        self.cov_matrix = self.returns.cov() * 252
        self.corr_matrix = self.returns.corr()
        self.volatilities = self.returns.std() * np.sqrt(252)

    def portfolio_performance(self, weights):
        """
        Calculate portfolio return and volatility for given weights.
        """
        weights = np.array(weights)
        port_return = np.dot(weights, self.mean_returns)
        port_vol = np.sqrt(np.dot(weights.T, np.dot(self.cov_matrix, weights)))
        sharpe = port_return / port_vol  # Assumes risk-free = 0

        return {
            'return': port_return,
            'volatility': port_vol,
            'sharpe_ratio': sharpe
        }

    def efficient_frontier(self, n_portfolios=5000):
        """
        Generate random portfolios to visualize the efficient frontier.
        """
        n_assets = len(self.tickers)
        results = []

        for _ in range(n_portfolios):
            # Random weights
            weights = np.random.random(n_assets)
            weights /= weights.sum()

            perf = self.portfolio_performance(weights)
            results.append({
                'return': perf['return'],
                'volatility': perf['volatility'],
                'sharpe': perf['sharpe_ratio'],
                'weights': weights
            })

        self.frontier_results = pd.DataFrame(results)
        return self.frontier_results

    def optimize_sharpe(self):
        """Find the maximum Sharpe ratio portfolio."""
        n_assets = len(self.tickers)

        def neg_sharpe(weights):
            perf = self.portfolio_performance(weights)
            return -perf['sharpe_ratio']

        constraints = {'type': 'eq', 'fun': lambda x: np.sum(x) - 1}
        bounds = tuple((0, 1) for _ in range(n_assets))
        init_weights = np.array([1/n_assets] * n_assets)

        result = minimize(neg_sharpe, init_weights,
                         method='SLSQP', bounds=bounds, constraints=constraints)

        optimal_weights = result.x
        perf = self.portfolio_performance(optimal_weights)

        return {
            'weights': dict(zip(self.tickers, optimal_weights)),
            'return': perf['return'],
            'volatility': perf['volatility'],
            'sharpe_ratio': perf['sharpe_ratio']
        }

    def optimize_min_volatility(self):
        """Find the minimum volatility portfolio."""
        n_assets = len(self.tickers)

        def portfolio_vol(weights):
            return np.sqrt(np.dot(weights.T, np.dot(self.cov_matrix, weights)))

        constraints = {'type': 'eq', 'fun': lambda x: np.sum(x) - 1}
        bounds = tuple((0, 1) for _ in range(n_assets))
        init_weights = np.array([1/n_assets] * n_assets)

        result = minimize(portfolio_vol, init_weights,
                         method='SLSQP', bounds=bounds, constraints=constraints)

        optimal_weights = result.x
        perf = self.portfolio_performance(optimal_weights)

        return {
            'weights': dict(zip(self.tickers, optimal_weights)),
            'return': perf['return'],
            'volatility': perf['volatility'],
            'sharpe_ratio': perf['sharpe_ratio']
        }

    def monte_carlo_var(self, weights, horizon_days=21, confidence=0.95, n_sims=10000):
        """
        Calculate portfolio VaR using Monte Carlo simulation.
        """
        weights = np.array(weights)

        # Portfolio returns
        port_returns = self.returns.dot(weights)
        mu = port_returns.mean()
        sigma = port_returns.std()

        # Simulate future returns
        np.random.seed(42)
        simulated_returns = np.random.normal(mu * horizon_days,
                                             sigma * np.sqrt(horizon_days),
                                             n_sims)

        var_pct = np.percentile(simulated_returns, (1 - confidence) * 100)
        cvar_pct = simulated_returns[simulated_returns <= var_pct].mean()

        return {
            'horizon_days': horizon_days,
            'confidence': confidence,
            'var_percent': var_pct,
            'cvar_percent': cvar_pct
        }

    def plot_correlation_heatmap(self):
        """Visualize correlation matrix."""
        plt.figure(figsize=(10, 8))
        sns.heatmap(self.corr_matrix, annot=True, cmap='RdYlGn', center=0,
                   fmt='.2f', square=True, linewidths=0.5)
        plt.title('Asset Correlation Matrix')
        plt.tight_layout()
        plt.savefig('correlation_heatmap.png', dpi=150)
        plt.show()

    def plot_efficient_frontier(self):
        """Visualize efficient frontier with optimal portfolios."""
        if not hasattr(self, 'frontier_results'):
            self.efficient_frontier()

        # Get optimal portfolios
        max_sharpe = self.optimize_sharpe()
        min_vol = self.optimize_min_volatility()

        fig, ax = plt.subplots(figsize=(12, 8))

        # Plot all portfolios
        scatter = ax.scatter(self.frontier_results['volatility'] * 100,
                            self.frontier_results['return'] * 100,
                            c=self.frontier_results['sharpe'],
                            cmap='viridis', alpha=0.5, s=10)

        # Plot individual assets
        for i, ticker in enumerate(self.tickers):
            ax.scatter(self.volatilities[ticker] * 100,
                      self.mean_returns[ticker] * 100,
                      s=100, marker='s', label=ticker)

        # Plot optimal portfolios
        ax.scatter(max_sharpe['volatility'] * 100, max_sharpe['return'] * 100,
                  s=200, c='red', marker='*', label='Max Sharpe')
        ax.scatter(min_vol['volatility'] * 100, min_vol['return'] * 100,
                  s=200, c='green', marker='*', label='Min Volatility')

        plt.colorbar(scatter, label='Sharpe Ratio')
        ax.set_xlabel('Volatility (%)')
        ax.set_ylabel('Expected Return (%)')
        ax.set_title('Efficient Frontier')
        ax.legend(loc='upper left')
        ax.grid(True, alpha=0.3)

        plt.tight_layout()
        plt.savefig('efficient_frontier.png', dpi=150)
        plt.show()

    def generate_report(self):
        """Generate comprehensive portfolio analysis report."""
        print("="*60)
        print("PORTFOLIO RISK ANALYSIS REPORT")
        print("="*60)

        print(f"\nAssets Analyzed: {', '.join(self.tickers)}")
        print(f"Analysis Period: {self.period}")

        print("\n--- Individual Asset Statistics ---")
        for ticker in self.tickers:
            print(f"\n{ticker}:")
            print(f"  Annual Return: {self.mean_returns[ticker]:.2%}")
            print(f"  Annual Volatility: {self.volatilities[ticker]:.2%}")
            print(f"  Sharpe Ratio: {self.mean_returns[ticker]/self.volatilities[ticker]:.2f}")

        print("\n--- Correlation Matrix ---")
        print(self.corr_matrix.round(2))

        # Equal weight portfolio
        eq_weights = [1/len(self.tickers)] * len(self.tickers)
        eq_perf = self.portfolio_performance(eq_weights)
        print("\n--- Equal Weight Portfolio ---")
        print(f"  Return: {eq_perf['return']:.2%}")
        print(f"  Volatility: {eq_perf['volatility']:.2%}")
        print(f"  Sharpe Ratio: {eq_perf['sharpe_ratio']:.2f}")

        # Optimal portfolios
        max_sharpe = self.optimize_sharpe()
        min_vol = self.optimize_min_volatility()

        print("\n--- Maximum Sharpe Portfolio ---")
        for ticker, weight in max_sharpe['weights'].items():
            print(f"  {ticker}: {weight:.1%}")
        print(f"  Return: {max_sharpe['return']:.2%}")
        print(f"  Volatility: {max_sharpe['volatility']:.2%}")
        print(f"  Sharpe Ratio: {max_sharpe['sharpe_ratio']:.2f}")

        print("\n--- Minimum Volatility Portfolio ---")
        for ticker, weight in min_vol['weights'].items():
            print(f"  {ticker}: {weight:.1%}")
        print(f"  Return: {min_vol['return']:.2%}")
        print(f"  Volatility: {min_vol['volatility']:.2%}")

        # VaR for max sharpe portfolio
        var = self.monte_carlo_var(list(max_sharpe['weights'].values()))
        print(f"\n--- 21-Day VaR (95%) for Max Sharpe Portfolio ---")
        print(f"  VaR: {var['var_percent']:.2%}")
        print(f"  CVaR (Expected Shortfall): {var['cvar_percent']:.2%}")

# Example usage
tickers = ['AAPL', 'MSFT', 'GOOGL', 'AMZN', 'JPM', 'JNJ', 'XOM']
analyzer = PortfolioRiskAnalyzer(tickers, period='5y')

# Generate report
analyzer.generate_report()

# Visualizations
analyzer.plot_correlation_heatmap()
analyzer.plot_efficient_frontier()</pre>
                </div>

                <div class="code-block">
                    <div class="code-header">
                        <span class="code-lang">R</span>
                        <span>Portfolio Analysis in R</span>
                    </div>
                    <pre>library(quantmod)
library(PerformanceAnalytics)
library(PortfolioAnalytics)
library(corrplot)

portfolio_analysis <- function(tickers, years = 5) {

  # Download data
  prices <- NULL
  for (ticker in tickers) {
    getSymbols(ticker, src = "yahoo",
               from = Sys.Date() - years * 365,
               auto.assign = FALSE) -> stock_data

    if (is.null(prices)) {
      prices <- Cl(stock_data)
    } else {
      prices <- merge(prices, Cl(stock_data))
    }
  }

  colnames(prices) <- tickers
  prices <- na.omit(prices)

  # Calculate returns
  returns <- Return.calculate(prices, method = "discrete")
  returns <- na.omit(returns)

  # Basic statistics
  cat("\n", paste(rep("=", 60), collapse=""), "\n")
  cat("PORTFOLIO RISK ANALYSIS\n")
  cat(paste(rep("=", 60), collapse=""), "\n")

  cat("\n--- Individual Asset Statistics (Annualized) ---\n")
  for (ticker in tickers) {
    ann_ret <- mean(returns[, ticker]) * 252
    ann_vol <- sd(returns[, ticker]) * sqrt(252)
    sharpe <- ann_ret / ann_vol
    cat(sprintf("\n%s:\n", ticker))
    cat(sprintf("  Return: %.2f%%\n", ann_ret * 100))
    cat(sprintf("  Volatility: %.2f%%\n", ann_vol * 100))
    cat(sprintf("  Sharpe: %.2f\n", sharpe))
  }

  # Correlation matrix
  cat("\n--- Correlation Matrix ---\n")
  corr_matrix <- cor(returns)
  print(round(corr_matrix, 2))

  # Plot correlation
  corrplot(corr_matrix, method = "color", type = "upper",
           addCoef.col = "black", tl.col = "black",
           title = "Asset Correlations")

  # Equal weight portfolio
  n_assets <- length(tickers)
  eq_weights <- rep(1/n_assets, n_assets)

  # Portfolio returns
  port_returns <- Return.portfolio(returns, weights = eq_weights)

  cat("\n--- Equal Weight Portfolio ---\n")
  cat(sprintf("  Annual Return: %.2f%%\n",
              mean(port_returns) * 252 * 100))
  cat(sprintf("  Annual Volatility: %.2f%%\n",
              sd(port_returns) * sqrt(252) * 100))
  cat(sprintf("  Sharpe Ratio: %.2f\n",
              SharpeRatio.annualized(port_returns)))

  # VaR and CVaR
  var_95 <- VaR(port_returns, p = 0.95, method = "historical")
  cvar_95 <- CVaR(port_returns, p = 0.95, method = "historical")

  cat("\n--- Risk Metrics (Daily) ---\n")
  cat(sprintf("  VaR (95%%): %.2f%%\n", abs(var_95) * 100))
  cat(sprintf("  CVaR (95%%): %.2f%%\n", abs(cvar_95) * 100))

  # Return data for further analysis
  return(list(
    prices = prices,
    returns = returns,
    correlation = corr_matrix
  ))
}

# Run analysis
result <- portfolio_analysis(c("AAPL", "MSFT", "GOOGL", "JPM", "JNJ"), 5)

# Charts
charts.PerformanceSummary(result$returns[, 1:3],
                          main = "Performance Summary")</pre>
                </div>
            </div>

            <!-- Interactive Calculator -->
            <div class="lesson-card">
                <h3>Interactive: Portfolio Risk Calculator</h3>
                <p>Calculate portfolio metrics for a two-asset portfolio.</p>

                <div class="calculator-container" id="portfolio-calc">
                    <div class="calculator-grid">
                        <div>
                            <h4>Asset 1</h4>
                            <label>Expected Return (%)</label>
                            <input type="number" id="port-return1" value="12" step="0.1">

                            <label>Volatility (%)</label>
                            <input type="number" id="port-vol1" value="20" step="0.1">

                            <label>Weight (%)</label>
                            <input type="number" id="port-weight1" value="60" step="1" min="0" max="100">
                        </div>

                        <div>
                            <h4>Asset 2</h4>
                            <label>Expected Return (%)</label>
                            <input type="number" id="port-return2" value="8" step="0.1">

                            <label>Volatility (%)</label>
                            <input type="number" id="port-vol2" value="15" step="0.1">

                            <label>Weight (%)</label>
                            <input type="number" id="port-weight2" value="40" step="1" min="0" max="100" readonly>
                        </div>

                        <div>
                            <h4>Correlation</h4>
                            <label>Correlation (ρ)</label>
                            <input type="number" id="port-correlation" value="0.3" step="0.05" min="-1" max="1">
                            <small style="color: #666;">Range: -1 to +1</small>
                        </div>
                    </div>

                    <button class="calculate-btn" onclick="calculatePortfolioRisk()">Calculate Portfolio Risk</button>

                    <div class="calculator-result" id="portfolio-result" style="display: none;">
                        <div class="result-row">
                            <span>Portfolio Expected Return:</span>
                            <span id="port-exp-return">-</span>
                        </div>
                        <div class="result-row">
                            <span>Portfolio Volatility:</span>
                            <span id="port-volatility">-</span>
                        </div>
                        <div class="result-row">
                            <span>Diversification Benefit:</span>
                            <span id="div-benefit">-</span>
                        </div>
                        <div class="result-row">
                            <span>Sharpe Ratio (Rf=0):</span>
                            <span id="port-sharpe">-</span>
                        </div>
                        <div class="result-row">
                            <span>95% VaR (1-year):</span>
                            <span id="port-var">-</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quiz -->
            <div class="lesson-card">
                <h3>Module 5 Quiz</h3>

                <div class="quiz-container">
                    <div class="quiz-question">
                        <p><strong>Question 1:</strong> A stock has daily returns with mean 0.05% and standard deviation 2%. The annualized volatility (assuming 252 trading days) is approximately:</p>
                        <div class="quiz-options">
                            <label><input type="radio" name="q5_1" value="a"> 2%</label>
                            <label><input type="radio" name="q5_1" value="b"> 8%</label>
                            <label><input type="radio" name="q5_1" value="c"> 32%</label>
                            <label><input type="radio" name="q5_1" value="d"> 504%</label>
                        </div>
                        <button onclick="checkQuiz5Answer('q5_1', 'c', 'Annualized volatility = Daily σ × √252 = 2% × √252 ≈ 2% × 15.87 ≈ 31.7% ≈ 32%')">Check Answer</button>
                        <div class="quiz-feedback" id="feedback-q5_1"></div>
                    </div>

                    <div class="quiz-question">
                        <p><strong>Question 2:</strong> In Monte Carlo simulation for stock prices, Geometric Brownian Motion (GBM) assumes returns are:</p>
                        <div class="quiz-options">
                            <label><input type="radio" name="q5_2" value="a"> Uniformly distributed</label>
                            <label><input type="radio" name="q5_2" value="b"> Log-normally distributed</label>
                            <label><input type="radio" name="q5_2" value="c"> Exponentially distributed</label>
                            <label><input type="radio" name="q5_2" value="d"> Binomially distributed</label>
                        </div>
                        <button onclick="checkQuiz5Answer('q5_2', 'b', 'GBM assumes log returns are normally distributed, which means price levels follow a log-normal distribution. This ensures prices cannot go negative.')">Check Answer</button>
                        <div class="quiz-feedback" id="feedback-q5_2"></div>
                    </div>

                    <div class="quiz-question">
                        <p><strong>Question 3:</strong> Two stocks both have 20% annual volatility. Stock A and B have correlation ρ = 0.5. A 50/50 portfolio will have volatility:</p>
                        <div class="quiz-options">
                            <label><input type="radio" name="q5_3" value="a"> 20% (same as individual stocks)</label>
                            <label><input type="radio" name="q5_3" value="b"> 17.3% (less than individual stocks)</label>
                            <label><input type="radio" name="q5_3" value="c"> 10% (half of individual stocks)</label>
                            <label><input type="radio" name="q5_3" value="d"> 40% (sum of individual stocks)</label>
                        </div>
                        <button onclick="checkQuiz5Answer('q5_3', 'b', 'σ²_p = 0.5²×0.2² + 0.5²×0.2² + 2×0.5×0.5×0.2×0.2×0.5 = 0.01 + 0.01 + 0.01 = 0.03. σ_p = √0.03 = 17.3%. This demonstrates diversification benefit when ρ < 1.')">Check Answer</button>
                        <div class="quiz-feedback" id="feedback-q5_3"></div>
                    </div>

                    <div class="quiz-question">
                        <p><strong>Question 4:</strong> A Jarque-Bera test returns p-value = 0.001 for a stock's returns. This means:</p>
                        <div class="quiz-options">
                            <label><input type="radio" name="q5_4" value="a"> Returns are perfectly normal</label>
                            <label><input type="radio" name="q5_4" value="b"> Returns are NOT normally distributed</label>
                            <label><input type="radio" name="q5_4" value="c"> The stock is a good investment</label>
                            <label><input type="radio" name="q5_4" value="d"> VaR calculations are unreliable</label>
                        </div>
                        <button onclick="checkQuiz5Answer('q5_4', 'b', 'A p-value of 0.001 < 0.05 means we reject the null hypothesis of normality. The returns have significant skewness and/or kurtosis, suggesting parametric VaR may underestimate risk.')">Check Answer</button>
                        <div class="quiz-feedback" id="feedback-q5_4"></div>
                    </div>
                </div>
            </div>

            <script>
            // Portfolio Risk Calculator
            document.getElementById('port-weight1').addEventListener('input', function() {
                document.getElementById('port-weight2').value = 100 - parseFloat(this.value);
            });

            function calculatePortfolioRisk() {
                const r1 = parseFloat(document.getElementById('port-return1').value) / 100;
                const r2 = parseFloat(document.getElementById('port-return2').value) / 100;
                const v1 = parseFloat(document.getElementById('port-vol1').value) / 100;
                const v2 = parseFloat(document.getElementById('port-vol2').value) / 100;
                const w1 = parseFloat(document.getElementById('port-weight1').value) / 100;
                const w2 = 1 - w1;
                const rho = parseFloat(document.getElementById('port-correlation').value);

                // Portfolio return
                const portReturn = w1 * r1 + w2 * r2;

                // Portfolio variance and volatility
                const portVar = w1*w1*v1*v1 + w2*w2*v2*v2 + 2*w1*w2*v1*v2*rho;
                const portVol = Math.sqrt(portVar);

                // Weighted average volatility (no diversification)
                const weightedVol = w1 * v1 + w2 * v2;
                const divBenefit = weightedVol - portVol;

                // Sharpe ratio
                const sharpe = portReturn / portVol;

                // 95% VaR (1-year, assuming normal)
                const var95 = portReturn - 1.645 * portVol;

                document.getElementById('port-exp-return').textContent = (portReturn * 100).toFixed(2) + '%';
                document.getElementById('port-volatility').textContent = (portVol * 100).toFixed(2) + '%';
                document.getElementById('div-benefit').textContent = (divBenefit * 100).toFixed(2) + '% reduction';
                document.getElementById('port-sharpe').textContent = sharpe.toFixed(2);
                document.getElementById('port-var').textContent = (var95 * 100).toFixed(2) + '%';

                document.getElementById('portfolio-result').style.display = 'block';
            }

            function checkQuiz5Answer(question, correct, explanation) {
                const selected = document.querySelector('input[name="' + question + '"]:checked');
                const feedback = document.getElementById('feedback-' + question);

                if (!selected) {
                    feedback.textContent = 'Please select an answer.';
                    feedback.style.color = '#e74c3c';
                    return;
                }

                if (selected.value === correct) {
                    feedback.innerHTML = '✓ Correct! ' + explanation;
                    feedback.style.color = '#27ae60';
                } else {
                    feedback.innerHTML = '✗ Incorrect. ' + explanation;
                    feedback.style.color = '#e74c3c';
                }
            }
            </script>

        </div>

        <div class="module-container" id="module-5">
            <div class="module-header">
                <h2>Module 6: Technical Analysis Fundamentals</h2>
                <p>Read charts and identify patterns for better entry/exit timing.</p>
            </div>
            <div class="lesson-card">
                <h3>Loading Module 6...</h3>
                <p>This module is being built. Content coming soon!</p>
            </div>
        </div>

        <div class="module-container" id="module-6">
            <div class="module-header">
                <h2>Module 7: Advanced Technical Indicators</h2>
                <p>Master RSI, MACD, Bollinger Bands, and more.</p>
            </div>
            <div class="lesson-card">
                <h3>Loading Module 7...</h3>
                <p>This module is being built. Content coming soon!</p>
            </div>
        </div>

        <div class="module-container" id="module-7">
            <div class="module-header">
                <h2>Module 8: The 30-Minute Analysis Framework</h2>
                <p>Your complete system for rapid, professional stock analysis.</p>
            </div>
            <div class="lesson-card">
                <h3>Loading Module 8...</h3>
                <p>This module is being built. Content coming soon!</p>
            </div>
        </div>

        <div class="module-container" id="module-8">
            <div class="module-header">
                <h2>Module 9: Python for Stock Analysis</h2>
                <p>Automate your analysis with Python programming.</p>
            </div>
            <div class="lesson-card">
                <h3>Loading Module 9...</h3>
                <p>This module is being built. Content coming soon!</p>
            </div>
        </div>

        <div class="module-container" id="module-9">
            <div class="module-header">
                <h2>Module 10: R for Statistical Analysis</h2>
                <p>Advanced statistics and Monte Carlo simulations with R.</p>
            </div>
            <div class="lesson-card">
                <h3>Loading Module 10...</h3>
                <p>This module is being built. Content coming soon!</p>
            </div>
        </div>
    </main>

    <!-- Settings Modal -->
    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <h3>API Settings</h3>
            <p>Enter your free Alpha Vantage API key to enable live stock data.</p>
            <p><small>Get your free key at <a href="https://www.alphavantage.co/support/#api-key" target="_blank">alphavantage.co</a></small></p>
            <input type="text" id="apiKeyInput" placeholder="Enter your API key">
            <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                <button class="calc-button" style="background: var(--gray);" onclick="closeSettings()">Cancel</button>
                <button class="calc-button" onclick="saveApiKey()">Save</button>
            </div>
        </div>
    </div>

    <script>
        // ============ NAVIGATION & PROGRESS ============
        let currentModule = 0;
        let progress = {
            completedLessons: [],
            quizScores: {},
            moduleProgress: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
        };

        // Load progress from localStorage
        function loadProgress() {
            const saved = localStorage.getItem('stockCourseProgress');
            if (saved) {
                progress = JSON.parse(saved);
                updateProgressDisplay();
            }
        }

        // Save progress to localStorage
        function saveProgress() {
            localStorage.setItem('stockCourseProgress', JSON.stringify(progress));
            updateProgressDisplay();
        }

        // Update progress bar display
        function updateProgressDisplay() {
            const totalModules = 10;
            const completedModules = progress.moduleProgress.filter(p => p === 100).length;
            const overallProgress = Math.round((completedModules / totalModules) * 100);

            document.getElementById('globalProgress').style.width = overallProgress + '%';
            document.getElementById('progressText').textContent = overallProgress + '% Complete';

            // Update sidebar indicators
            const navLinks = document.querySelectorAll('.module-nav a');
            navLinks.forEach((link, index) => {
                if (progress.moduleProgress[index] === 100) {
                    link.classList.add('completed');
                }
            });
        }

        // Show module
        function showModule(index) {
            // Hide all modules
            document.querySelectorAll('.module-container').forEach(m => m.classList.remove('active'));

            // Show selected module
            document.getElementById('module-' + index).classList.add('active');

            // Update nav
            document.querySelectorAll('.module-nav a').forEach((a, i) => {
                a.classList.remove('active');
                if (i === index) a.classList.add('active');
            });

            currentModule = index;
            window.scrollTo(0, 0);
        }

        // ============ CALCULATORS ============

        // Margin Calculator
        function calculateMargins() {
            const revenue = parseFloat(document.getElementById('marginRevenue').value);
            const cogs = parseFloat(document.getElementById('marginCOGS').value);
            const opex = parseFloat(document.getElementById('marginOpex').value);
            const netIncome = parseFloat(document.getElementById('marginNetIncome').value);

            if (isNaN(revenue) || revenue === 0) {
                alert('Please enter a valid revenue amount');
                return;
            }

            const grossProfit = revenue - cogs;
            const operatingIncome = grossProfit - opex;

            const grossMargin = ((grossProfit / revenue) * 100).toFixed(2);
            const operatingMargin = ((operatingIncome / revenue) * 100).toFixed(2);
            const netMargin = ((netIncome / revenue) * 100).toFixed(2);

            const output = `
                <div class="result-value">Gross Margin: ${grossMargin}%</div>
                <div class="result-breakdown">
                    <p><strong>Operating Margin:</strong> ${operatingMargin}%</p>
                    <p><strong>Net Profit Margin:</strong> ${netMargin}%</p>
                    <hr style="margin: 1rem 0;">
                    <p><strong>Gross Profit:</strong> $${grossProfit.toLocaleString()}</p>
                    <p><strong>Operating Income:</strong> $${operatingIncome.toLocaleString()}</p>
                    <p><strong>Interpretation:</strong>
                        ${grossMargin > 40 ? 'Strong gross margin indicates pricing power or efficient production.' :
                          grossMargin > 20 ? 'Decent gross margin, typical for many industries.' :
                          'Low gross margin - this is common in retail or commodity businesses.'}
                    </p>
                </div>
            `;

            document.getElementById('marginResult').style.display = 'block';
            document.getElementById('marginOutput').innerHTML = output;
        }

        // FCF Calculator
        function calculateFCF() {
            const ocf = parseFloat(document.getElementById('fcfOCF').value);
            const capex = parseFloat(document.getElementById('fcfCapex').value);
            const shares = parseFloat(document.getElementById('fcfShares').value);
            const price = parseFloat(document.getElementById('fcfPrice').value);

            if (isNaN(ocf) || isNaN(capex)) {
                alert('Please enter valid cash flow values');
                return;
            }

            const fcf = ocf - capex;
            const fcfPerShare = shares ? (fcf / shares).toFixed(2) : 'N/A';
            const fcfYield = (shares && price) ? ((fcf / shares / price) * 100).toFixed(2) : 'N/A';
            const priceFCF = (shares && price && fcf > 0) ? ((price * shares) / fcf).toFixed(2) : 'N/A';

            const output = `
                <div class="result-value">Free Cash Flow: $${fcf.toLocaleString()}</div>
                <div class="result-breakdown">
                    <p><strong>FCF per Share:</strong> $${fcfPerShare}</p>
                    <p><strong>FCF Yield:</strong> ${fcfYield}%</p>
                    <p><strong>Price/FCF Ratio:</strong> ${priceFCF}x</p>
                    <hr style="margin: 1rem 0;">
                    <p><strong>Interpretation:</strong>
                        ${fcf > 0 ? 'Positive FCF means the company generates cash after investments.' :
                          'Negative FCF may indicate heavy investment phase or operational issues.'}
                        ${fcfYield !== 'N/A' && parseFloat(fcfYield) > 5 ? ' High FCF yield suggests potential undervaluation.' : ''}
                    </p>
                </div>
            `;

            document.getElementById('fcfResult').style.display = 'block';
            document.getElementById('fcfOutput').innerHTML = output;
        }

        // CAGR Calculator
        function calculateCAGR() {
            const start = parseFloat(document.getElementById('cagrStart').value);
            const end = parseFloat(document.getElementById('cagrEnd').value);
            const years = parseFloat(document.getElementById('cagrYears').value);

            if (isNaN(start) || isNaN(end) || isNaN(years) || start === 0 || years === 0) {
                alert('Please enter valid values');
                return;
            }

            const cagr = (Math.pow(end / start, 1 / years) - 1) * 100;
            const totalGrowth = ((end - start) / start) * 100;

            const output = `
                <div class="result-value">CAGR: ${cagr.toFixed(2)}%</div>
                <div class="result-breakdown">
                    <p><strong>Total Growth:</strong> ${totalGrowth.toFixed(2)}%</p>
                    <p><strong>Starting Value:</strong> $${start.toLocaleString()}</p>
                    <p><strong>Ending Value:</strong> $${end.toLocaleString()}</p>
                    <p><strong>Period:</strong> ${years} years</p>
                    <hr style="margin: 1rem 0;">
                    <p><strong>Interpretation:</strong>
                        ${cagr > 20 ? 'Exceptional growth rate - typical of high-growth tech companies.' :
                          cagr > 10 ? 'Strong growth rate - above market average.' :
                          cagr > 5 ? 'Moderate growth - roughly in line with GDP + inflation.' :
                          cagr > 0 ? 'Low growth - may indicate mature or declining business.' :
                          'Negative growth - the business is shrinking.'}
                    </p>
                </div>
            `;

            document.getElementById('cagrResult').style.display = 'block';
            document.getElementById('cagrOutput').innerHTML = output;
        }

        // ============ MODULE 2 CALCULATORS ============

        // Profitability Calculator
        function calculateProfitability() {
            const netIncome = parseFloat(document.getElementById('profitNetIncome').value);
            const revenue = parseFloat(document.getElementById('profitRevenue').value);
            const equity = parseFloat(document.getElementById('profitEquity').value);
            const assets = parseFloat(document.getElementById('profitAssets').value);

            if (isNaN(netIncome) || isNaN(equity) || equity === 0) {
                alert('Please enter valid values');
                return;
            }

            const roe = ((netIncome / equity) * 100).toFixed(2);
            const roa = assets ? ((netIncome / assets) * 100).toFixed(2) : 'N/A';
            const netMargin = revenue ? ((netIncome / revenue) * 100).toFixed(2) : 'N/A';
            const assetTurnover = (revenue && assets) ? (revenue / assets).toFixed(2) : 'N/A';
            const equityMultiplier = (assets && equity) ? (assets / equity).toFixed(2) : 'N/A';

            const output = `
                <div class="result-value">ROE: ${roe}%</div>
                <div class="result-breakdown">
                    <p><strong>ROA:</strong> ${roa}%</p>
                    <p><strong>Net Profit Margin:</strong> ${netMargin}%</p>
                    <hr style="margin: 1rem 0;">
                    <p><strong>DuPont Breakdown:</strong></p>
                    <p>Net Margin (${netMargin}%) × Asset Turnover (${assetTurnover}x) × Equity Multiplier (${equityMultiplier}x) = ROE</p>
                    <hr style="margin: 1rem 0;">
                    <p><strong>Interpretation:</strong>
                        ${parseFloat(roe) > 20 ? 'Excellent ROE - company generates strong returns for shareholders.' :
                          parseFloat(roe) > 15 ? 'Good ROE - above average profitability.' :
                          parseFloat(roe) > 10 ? 'Decent ROE - acceptable for many industries.' :
                          'Low ROE - investigate whether this is due to low margins, poor asset efficiency, or low leverage.'}
                    </p>
                </div>
            `;

            document.getElementById('profitResult').style.display = 'block';
            document.getElementById('profitOutput').innerHTML = output;
        }

        // Valuation Multiple Calculator
        function calculateValuation() {
            const price = parseFloat(document.getElementById('valPrice').value);
            const shares = parseFloat(document.getElementById('valShares').value);
            const eps = parseFloat(document.getElementById('valEPS').value);
            const revenue = parseFloat(document.getElementById('valRevenue').value);
            const book = parseFloat(document.getElementById('valBook').value);
            const ebitda = parseFloat(document.getElementById('valEBITDA').value);
            const debt = parseFloat(document.getElementById('valDebt').value) || 0;
            const cash = parseFloat(document.getElementById('valCash').value) || 0;

            if (isNaN(price) || isNaN(shares)) {
                alert('Please enter stock price and shares outstanding');
                return;
            }

            const marketCap = price * shares;
            const ev = marketCap + debt - cash;
            const pe = eps ? (price / eps).toFixed(2) : 'N/A';
            const ps = revenue ? (marketCap / revenue).toFixed(2) : 'N/A';
            const pb = book ? (marketCap / book).toFixed(2) : 'N/A';
            const evEbitda = ebitda ? (ev / ebitda).toFixed(2) : 'N/A';

            const output = `
                <div class="result-value">Market Cap: $${(marketCap/1000).toFixed(1)}B</div>
                <div class="result-breakdown">
                    <p><strong>Enterprise Value:</strong> $${(ev/1000).toFixed(1)}B</p>
                    <hr style="margin: 1rem 0;">
                    <table class="data-table">
                        <tr><th>Multiple</th><th>Value</th><th>Assessment</th></tr>
                        <tr>
                            <td>P/E</td>
                            <td>${pe}x</td>
                            <td>${pe !== 'N/A' ? (parseFloat(pe) < 15 ? 'Cheap' : parseFloat(pe) < 25 ? 'Fair' : 'Expensive') : '-'}</td>
                        </tr>
                        <tr>
                            <td>P/S</td>
                            <td>${ps}x</td>
                            <td>${ps !== 'N/A' ? (parseFloat(ps) < 2 ? 'Cheap' : parseFloat(ps) < 5 ? 'Fair' : 'Expensive') : '-'}</td>
                        </tr>
                        <tr>
                            <td>P/B</td>
                            <td>${pb}x</td>
                            <td>${pb !== 'N/A' ? (parseFloat(pb) < 1 ? 'Below Book' : parseFloat(pb) < 3 ? 'Fair' : 'Premium') : '-'}</td>
                        </tr>
                        <tr>
                            <td>EV/EBITDA</td>
                            <td>${evEbitda}x</td>
                            <td>${evEbitda !== 'N/A' ? (parseFloat(evEbitda) < 8 ? 'Cheap' : parseFloat(evEbitda) < 12 ? 'Fair' : 'Expensive') : '-'}</td>
                        </tr>
                    </table>
                </div>
            `;

            document.getElementById('valResult').style.display = 'block';
            document.getElementById('valOutput').innerHTML = output;
        }

        // PEG Calculator
        function calculatePEG() {
            const pe = parseFloat(document.getElementById('pegPE').value);
            const growth = parseFloat(document.getElementById('pegGrowth').value);
            const revGrowth = parseFloat(document.getElementById('rule40Growth').value);
            const margin = parseFloat(document.getElementById('rule40Margin').value);

            let output = '';

            if (!isNaN(pe) && !isNaN(growth) && growth !== 0) {
                const peg = (pe / growth).toFixed(2);
                output += `
                    <div class="result-value">PEG Ratio: ${peg}</div>
                    <div class="result-breakdown">
                        <p><strong>Interpretation:</strong>
                            ${parseFloat(peg) < 1 ? 'Potentially undervalued relative to growth rate.' :
                              parseFloat(peg) <= 1.5 ? 'Fairly valued given growth expectations.' :
                              'May be overvalued - P/E is high relative to growth.'}
                        </p>
                    </div>
                `;
            }

            if (!isNaN(revGrowth) && !isNaN(margin)) {
                const rule40 = revGrowth + margin;
                const passes = rule40 >= 40;
                output += `
                    <hr style="margin: 1rem 0;">
                    <div class="result-value">Rule of 40 Score: ${rule40.toFixed(1)}%</div>
                    <div class="result-breakdown">
                        <p><strong>Result:</strong> ${passes ? 'PASSES' : 'FAILS'} the Rule of 40</p>
                        <p>Revenue Growth (${revGrowth}%) + Profit Margin (${margin}%) = ${rule40.toFixed(1)}%</p>
                        <p>${passes ? 'This indicates a healthy balance of growth and profitability.' : 'The company may need to improve either growth or profitability.'}</p>
                    </div>
                `;
            }

            if (output === '') {
                alert('Please enter values for at least one calculation');
                return;
            }

            document.getElementById('pegResult').style.display = 'block';
            document.getElementById('pegOutput').innerHTML = output;
        }

        // DuPont Calculator
        function calculateDuPont() {
            const netIncome = parseFloat(document.getElementById('dupontNetIncome').value);
            const revenue = parseFloat(document.getElementById('dupontRevenue').value);
            const assets = parseFloat(document.getElementById('dupontAssets').value);
            const equity = parseFloat(document.getElementById('dupontEquity').value);

            if (isNaN(netIncome) || isNaN(revenue) || isNaN(assets) || isNaN(equity) ||
                revenue === 0 || assets === 0 || equity === 0) {
                alert('Please enter all values');
                return;
            }

            const netMargin = (netIncome / revenue) * 100;
            const assetTurnover = revenue / assets;
            const equityMultiplier = assets / equity;
            const roe = netMargin * assetTurnover * equityMultiplier / 100;

            // Determine the primary driver
            let driver = '';
            if (netMargin > 15) driver = 'High profit margins';
            else if (assetTurnover > 1.5) driver = 'Efficient asset utilization';
            else if (equityMultiplier > 2) driver = 'Financial leverage';
            else driver = 'Balanced across all factors';

            const output = `
                <div class="result-value">ROE: ${(roe * 100).toFixed(2)}%</div>
                <div class="result-breakdown">
                    <table class="data-table">
                        <tr><th>Component</th><th>Value</th><th>What It Measures</th></tr>
                        <tr>
                            <td>Net Profit Margin</td>
                            <td>${netMargin.toFixed(2)}%</td>
                            <td>Efficiency (profit per dollar of sales)</td>
                        </tr>
                        <tr>
                            <td>Asset Turnover</td>
                            <td>${assetTurnover.toFixed(2)}x</td>
                            <td>Productivity (sales per dollar of assets)</td>
                        </tr>
                        <tr>
                            <td>Equity Multiplier</td>
                            <td>${equityMultiplier.toFixed(2)}x</td>
                            <td>Leverage (assets per dollar of equity)</td>
                        </tr>
                    </table>
                    <hr style="margin: 1rem 0;">
                    <p><strong>Formula Check:</strong> ${netMargin.toFixed(2)}% × ${assetTurnover.toFixed(2)} × ${equityMultiplier.toFixed(2)} = ${(roe * 100).toFixed(2)}%</p>
                    <p><strong>Primary Driver:</strong> ${driver}</p>
                    <p><strong>Insight:</strong> ${equityMultiplier > 3 ? 'Warning: High leverage increases risk. ROE may not be sustainable if debt becomes problematic.' : 'Leverage is at reasonable levels.'}</p>
                </div>
            `;

            document.getElementById('dupontResult').style.display = 'block';
            document.getElementById('dupontOutput').innerHTML = output;
        }

        // Module 2 Quiz
        function checkQuiz2() {
            const answers = {
                m2q1: 'b',  // 20/25 = 0.80
                m2q2: 'c',  // EV/EBITDA
                m2q3: 'a',  // Net Margin × Asset Turnover × Equity Multiplier
                m2q4: 'c'   // No, 35 + (-10) = 25%
            };

            let correct = 0;
            let total = 4;

            for (let q in answers) {
                const selected = document.querySelector(`input[name="${q}"]:checked`);
                const options = document.querySelectorAll(`#${q} .quiz-option`);

                options.forEach(opt => {
                    opt.classList.remove('correct', 'incorrect', 'selected');
                });

                if (selected) {
                    const selectedOption = selected.closest('.quiz-option');
                    if (selected.value === answers[q]) {
                        selectedOption.classList.add('correct');
                        correct++;
                    } else {
                        selectedOption.classList.add('incorrect');
                        options.forEach(opt => {
                            if (opt.querySelector('input').value === answers[q]) {
                                opt.classList.add('correct');
                            }
                        });
                    }
                }
            }

            const feedback = document.getElementById('quiz2Feedback');
            const percentage = Math.round((correct / total) * 100);

            if (percentage >= 75) {
                feedback.className = 'quiz-feedback correct';
                feedback.innerHTML = `Excellent! You scored ${correct}/${total} (${percentage}%). You've mastered financial ratios!`;
                progress.quizScores['module2'] = percentage;
                progress.moduleProgress[1] = 100;
                saveProgress();
            } else {
                feedback.className = 'quiz-feedback incorrect';
                feedback.innerHTML = `You scored ${correct}/${total} (${percentage}%). Review the material and try again. You need 75% to pass.`;
            }
        }

        // ============ QUIZ SYSTEM ============

        function checkQuiz1() {
            const answers = {
                q1: 'b',  // Income Statement
                q2: 'b',  // 20% - Operating Income = 200-120-40=40, 40/200=20%
                q3: 'b',  // OCF - CapEx
                q4: 'b'   // May struggle with short-term obligations
            };

            let correct = 0;
            let total = 4;

            for (let q in answers) {
                const selected = document.querySelector(`input[name="${q}"]:checked`);
                const options = document.querySelectorAll(`#${q} .quiz-option`);

                options.forEach(opt => {
                    opt.classList.remove('correct', 'incorrect', 'selected');
                });

                if (selected) {
                    const selectedOption = selected.closest('.quiz-option');
                    if (selected.value === answers[q]) {
                        selectedOption.classList.add('correct');
                        correct++;
                    } else {
                        selectedOption.classList.add('incorrect');
                        // Show correct answer
                        options.forEach(opt => {
                            if (opt.querySelector('input').value === answers[q]) {
                                opt.classList.add('correct');
                            }
                        });
                    }
                }
            }

            const feedback = document.getElementById('quiz1Feedback');
            const percentage = Math.round((correct / total) * 100);

            if (percentage >= 75) {
                feedback.className = 'quiz-feedback correct';
                feedback.innerHTML = `Great job! You scored ${correct}/${total} (${percentage}%). You've mastered the fundamentals!`;
                progress.quizScores['module1'] = percentage;
                progress.moduleProgress[0] = 100;
                saveProgress();
            } else {
                feedback.className = 'quiz-feedback incorrect';
                feedback.innerHTML = `You scored ${correct}/${total} (${percentage}%). Review the material and try again. You need 75% to pass.`;
            }
        }

        // ============ API & SETTINGS ============
        let apiKey = localStorage.getItem('alphaVantageKey') || '';

        function openSettings() {
            document.getElementById('settingsModal').classList.add('active');
            document.getElementById('apiKeyInput').value = apiKey;
        }

        function closeSettings() {
            document.getElementById('settingsModal').classList.remove('active');
        }

        function saveApiKey() {
            apiKey = document.getElementById('apiKeyInput').value;
            localStorage.setItem('alphaVantageKey', apiKey);
            closeSettings();
            alert('API key saved successfully!');
        }

        // Fetch stock data from Alpha Vantage
        async function fetchStockData(symbol) {
            if (!apiKey) {
                alert('Please set your API key in Settings first.');
                openSettings();
                return null;
            }

            try {
                const response = await fetch(
                    `https://www.alphavantage.co/query?function=OVERVIEW&symbol=${symbol}&apikey=${apiKey}`
                );
                const data = await response.json();

                if (data['Error Message'] || data['Note']) {
                    alert('API error. Please check your API key or try again later.');
                    return null;
                }

                return data;
            } catch (error) {
                console.error('Error fetching stock data:', error);
                alert('Error fetching data. Please try again.');
                return null;
            }
        }

        // ============ INITIALIZATION ============
        document.addEventListener('DOMContentLoaded', function() {
            loadProgress();
        });
    </script>
</body>
</html>

